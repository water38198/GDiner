import{y as O,r as b,x as H,o as c,c as m,a as e,t as _,b as a,w as R,n as f,p as q,F as D,g as S,k as B,v as A,D as Y,E as z,h as N,S as V,M as G,f as T,_ as J,e as K,u as j}from"./index-DuHCPTtL.js";import{u as Q}from"./index-CkGfcHWQ.js";const W={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},X={class:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"},Z={class:"modal-content"},ee={class:"modal-header"},le={class:"modal-title fs-2",id:"ProductModalLabel"},te={class:"modal-body"},se={class:"container-fluid"},ae={class:"row"},oe={class:"col-12 col-md-4"},ie=["src"],ne={action:"/api/thisismycourse2/admin/upload",enctype:"multipart/form-data",method:"post",class:"my-4"},de={class:"d-flex align-items-center mb-2"},re=["for"],ue=["onClick"],ce=["onUpdate:modelValue"],me=["src"],ve={action:"/api/thisismycourse2/admin/upload",enctype:"multipart/form-data",method:"post"},pe={class:"col-12 col-md-8"},fe={class:"row gy-4"},be={class:"col-12"},ge={class:"col-6"},_e={class:"col-6"},ye={class:"col-6"},Ve={class:"col-6"},he={class:"col-6"},Ue={class:"col-12"},$e={key:0,class:"list-unstyled d-flex"},ke=["onClick"],xe={class:"input-group"},we={class:"col-12"},Ce={class:"col-12"},Pe={class:"col-12"},Ee={class:"form-check"},Me={class:"modal-footer"},Te=["disabled"],De={__name:"ProductModal",props:{product:{type:Object,default:()=>({})},isNew:{type:Boolean,default:!1}},emits:["refresh"],setup(F,{emit:P}){const{VITE_URL:h,VITE_PATH:U}=W,u=F,x=P,w=O(()=>u.isNew?"新增商品":"編輯商品"),t=b({...u.product});H(()=>u.product,d=>{t.value={...d}});const $=b(null),I=async()=>{const d=u.isNew?"post":"put",l=u.isNew?`${h}/v2/api/${U}/admin/product`:`${h}/v2/api/${U}/admin/product/${t.value.id}`;(u.isNew||!t.value.created)&&(t.value.created=Date.now());try{C.value=!0;const i=await N[d](l,{data:t.value});V.fire({icon:"success",title:`${i.data.message}`,showConfirmButton:!1,timer:1500,didClose:()=>{C.value=!1,x("refresh"),G.getInstance($.value).hide()}})}catch(i){V.fire({icon:"error",title:"錯誤",text:`${i.response.data.message||"請稍後再試"}`})}},E=()=>{t.value.imagesUrl||(t.value.imagesUrl=[]);const d=t.value.imagesUrl.length;t.value.imagesUrl[d-1]!==""&&t.value.imagesUrl.push("")},M=async(d,l)=>{const i=l.target.files[0],r=new FormData;r.append("file-to-upload",i);try{const k=await N.post(`${h}/v2/api/${U}/admin/upload`,r);E(),d==="image"&&(t.value.imageUrl=k.data.imageUrl),d==="images"&&(t.value.imagesUrl[t.value.imagesUrl.length-1]=k.data.imageUrl),l.target.value=""}catch(k){V.fire({icon:"error",title:"上傳失敗",text:`${k.response.data.message||"請稍後再試"}`})}},v=d=>{t.value.imagesUrl.splice(d,1)},o=b(""),g=()=>{t.value.tags||(t.value.tags=[]),o.value.trim()!==""&&(t.value.tags.push(o.value),o.value="")},n=d=>{t.value.tags=t.value.tags.filter(l=>l!==d)},C=b(!1);return(d,l)=>{const i=T("VField"),r=T("ErrorMessage"),k=T("VForm");return c(),m("div",{class:"modal fade",id:"ProductModal",tabindex:"-1","aria-labelledby":"ProductLabel","aria-hidden":"true",ref_key:"modalRef",ref:$},[e("div",X,[e("div",Z,[e("div",ee,[e("h1",le,_(w.value),1),l[13]||(l[13]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",te,[a(k,{onSubmit:I,id:"ProductForm"},{default:R(({errors:p})=>[e("div",se,[e("div",ae,[e("div",oe,[l[17]||(l[17]=e("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1)),a(i,{name:"主要圖片",id:"imageUrl",type:"text",placeholder:"請輸入圖片連結",modelValue:t.value.imageUrl,"onUpdate:modelValue":l[0]||(l[0]=s=>t.value.imageUrl=s),class:f(["form-control mb-2",{"is-invalid":p.主要圖片}]),rules:"required"},null,8,["modelValue","class"]),a(r,{name:"主要圖片",class:"invalid-feedback"}),t.value.imageUrl?(c(),m("img",{key:0,src:t.value.imageUrl,alt:"產品主要照片"},null,8,ie)):q("",!0),e("form",ne,[e("input",{type:"file",name:"file-to-upload",onChange:l[1]||(l[1]=s=>M("image",s)),class:"form-control"},null,32)]),e("div",null,[l[15]||(l[15]=e("h4",{class:"mb-4 fs-6"},"多圖新增",-1)),(c(!0),m(D,null,S(t.value.imagesUrl,(s,y)=>(c(),m("div",{key:s,class:"mb-4"},[e("div",de,[e("label",{for:`image-${y}`,class:"form-label"},"圖片網址"+_(y+1),9,re),e("button",{type:"button",class:"ms-auto fs-5",onClick:L=>v(y)},l[14]||(l[14]=[e("i",{class:"bi bi-x"},null,-1)]),8,ue)]),e("div",null,[B(e("input",{type:"text","onUpdate:modelValue":L=>t.value.imagesUrl[y]=L,placeholder:"請輸入圖片網址",class:"form-control"},null,8,ce),[[A,t.value.imagesUrl[y]]])]),e("img",{src:s,alt:"產品照片"},null,8,me)]))),128)),e("div",{class:"mb-4"},[e("button",{type:"button",onClick:E,class:"btn btn-outline-primary"},"新增圖片")]),l[16]||(l[16]=e("hr",null,null,-1)),e("form",ve,[e("input",{type:"file",name:"file-to-upload",onChange:l[2]||(l[2]=s=>M("images",s)),class:"form-control"},null,32)])])]),e("div",pe,[e("div",fe,[e("div",be,[l[18]||(l[18]=e("label",{for:"title",class:"form-label"},"名稱：",-1)),a(i,{type:"text",id:"title",name:"名稱",rules:"required",placeholder:"請輸入標題",modelValue:t.value.title,"onUpdate:modelValue":l[3]||(l[3]=s=>t.value.title=s),class:f(["form-control",{"is-invalid":p.名稱}])},null,8,["modelValue","class"]),a(r,{name:"名稱",class:"invalid-feedback"})]),e("div",ge,[l[20]||(l[20]=e("label",{for:"category",class:"form-label"},"分類：",-1)),a(i,{as:"select",name:"分類",rules:"required",id:"category",class:f(["form-select",{"is-invalid":p.分類}]),modelValue:t.value.category,"onUpdate:modelValue":l[4]||(l[4]=s=>t.value.category=s)},{default:R(()=>l[19]||(l[19]=[e("option",{value:"主食"},"主食",-1),e("option",{value:"沙拉"},"沙拉",-1),e("option",{value:"湯品"},"湯品",-1),e("option",{value:"副食"},"副食",-1),e("option",{value:"甜點"},"甜點",-1),e("option",{value:"飲料"},"飲料",-1),e("option",{value:"套餐"},"套餐",-1)])),_:2},1032,["class","modelValue"]),a(r,{name:"分類",class:"invalid-feedback"})]),e("div",_e,[l[21]||(l[21]=e("label",{for:"unit",class:"form-label"},"單位：",-1)),a(i,{type:"text",id:"unit",placeholder:"請輸入單位",modelValue:t.value.unit,"onUpdate:modelValue":l[5]||(l[5]=s=>t.value.unit=s),list:"units",name:"單位",rules:"required",class:f(["form-control",{"is-invalid":p.單位}]),autocomplete:"off"},null,8,["modelValue","class"]),l[22]||(l[22]=e("datalist",{id:"units"},[e("option",{value:"碗"}),e("option",{value:"客"}),e("option",{value:"杯"}),e("option",{value:"份"}),e("option",{value:"個"})],-1)),a(r,{name:"單位",class:"invalid-feedback"})]),e("div",ye,[l[23]||(l[23]=e("label",{for:"origin_price",class:"form-label"},"原價：",-1)),a(i,{type:"number",name:"原價",id:"origin_price",placeholder:"請輸入原價",min:"0",rules:"required|min_value:0",class:f(["form-control",{"is-invalid":p.原價}]),modelValue:t.value.origin_price,"onUpdate:modelValue":l[6]||(l[6]=s=>t.value.origin_price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),a(r,{name:"原價",class:"invalid-feedback"})]),e("div",Ve,[l[24]||(l[24]=e("label",{for:"price",class:"form-label"},"售價：",-1)),a(i,{type:"number",id:"price",placeholder:"請輸入售價",min:"0",modelValue:t.value.price,"onUpdate:modelValue":l[7]||(l[7]=s=>t.value.price=s),modelModifiers:{number:!0},name:"售價",rules:{required:!0,max_value:t.value.origin_price,min_value:0},class:f(["form-control",{"is-invalid":p.售價}])},null,8,["modelValue","rules","class"]),a(r,{name:"售價",class:"invalid-feedback"})]),e("div",he,[l[26]||(l[26]=e("label",{for:"veggie",class:"form-label"},"素食:",-1)),a(i,{as:"select",id:"veggie",modelValue:t.value.veggie,"onUpdate:modelValue":l[8]||(l[8]=s=>t.value.veggie=s),name:"素食",rules:"required",class:f(["form-select",{"is-invalid":p.素食}])},{default:R(()=>l[25]||(l[25]=[e("option",{value:"全素",class:"text-success"},"全素",-1),e("option",{value:"蛋奶素",class:"text-warning"},"蛋奶素",-1),e("option",{value:"葷食",class:"text-danger"},"葷食",-1)])),_:2},1032,["modelValue","class"]),a(r,{name:"素食",class:"invalid-feedback"})]),e("div",Ue,[l[27]||(l[27]=e("label",{for:"tags",class:"form-label"},"標籤：",-1)),t.value.tags?(c(),m("ul",$e,[(c(!0),m(D,null,S(t.value.tags,(s,y)=>(c(),m("li",{key:`${y}+${s}`},[e("button",{class:"btn btn-outline-primary",onClick:L=>n(s)},_(s),9,ke)]))),128))])):q("",!0),e("div",xe,[B(e("input",{type:"text",id:"tags","onUpdate:modelValue":l[9]||(l[9]=s=>o.value=s),onKeydown:Y(g,["enter"]),class:"form-control"},null,544),[[A,o.value,void 0,{trim:!0}]]),e("button",{type:"button",class:"btn btn-outline-primary",onClick:g},"新增標籤")])]),e("div",we,[l[28]||(l[28]=e("label",{for:"description",class:"form-label"},"商品敘述:",-1)),a(i,{as:"textarea",id:"description",rows:"6",modelValue:t.value.description,"onUpdate:modelValue":l[10]||(l[10]=s=>t.value.description=s),name:"產品敘述",rules:"required",class:f(["form-control",{"is-invalid":p.產品敘述}]),placeholder:"例如：這是法國進口超好吃的馬卡龍，加上阿橘大廚特製的冰淇淋"},null,8,["modelValue","class"]),a(r,{name:"產品敘述",class:"invalid-feedback"})]),e("div",Ce,[l[29]||(l[29]=e("label",{for:"content",class:"form-label"},"商品內容:",-1)),a(i,{as:"textarea",id:"content",rows:"4",class:f(["form-control",{"is-invalid":p.商品內容}]),modelValue:t.value.content,"onUpdate:modelValue":l[11]||(l[11]=s=>t.value.content=s),name:"商品內容",rules:"required",placeholder:"例如：牛排 * 1 客"},null,8,["modelValue","class"]),a(r,{name:"商品內容",class:"invalid-feedback"})]),e("div",Pe,[e("div",Ee,[B(e("input",{class:"form-check-input",type:"checkbox",id:"is_enabled","onUpdate:modelValue":l[12]||(l[12]=s=>t.value.is_enabled=s),"true-value":1,"false-value":0},null,512),[[z,t.value.is_enabled]]),l[30]||(l[30]=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1))])])])])])])]),_:1})]),e("div",Me,[l[31]||(l[31]=e("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"},"取消",-1)),e("button",{type:"submit",form:"ProductForm",class:"btn btn-primary",disabled:C.value},"確認",8,Te)])])])],512)}}},Ne={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},Ie={class:"position-relative container py-10"},Le={class:"table-responsive"},Re={class:"table align-middle"},Be={class:"table-group-divider"},Se=["src","alt"],Fe={key:0,class:"text-success"},qe={key:1,class:"text-danger"},Ae={class:"text-end"},Oe={class:"btn-group",role:"group","aria-label":"edit button group"},He=["onClick"],Ye=["onClick"],ze={__name:"AdminProducts",setup(F){const{VITE_URL:P,VITE_PATH:h}=Ne,U=b([]),u=b(!1),x=b({}),w=b(!1),t=b({}),$=async(v=1)=>{try{u.value=!0;const o=await N.get(`${P}/v2/api/${h}/admin/products?page=${v}`);U.value=o.data.products,t.value=o.data.pagination}catch(o){V.fire({icon:"error",title:"錯誤",text:`${o.response.data.message||"請稍後再試"}`})}finally{u.value=!1}};K(()=>{$()});const I=()=>{x.value={},w.value=!0},E=v=>{x.value=JSON.parse(JSON.stringify(v)),w.value=!1},M=v=>{V.fire({title:`確定要刪除${v.title}嗎？`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",confirmButtonColor:"#d33",cancelButtonText:"取消"}).then(async o=>{if(o.isConfirmed)try{u.value=!0;const g=await N.delete(`${P}/v2/api/${h}/admin/product/${v.id}`);V.fire({title:g.data.message,icon:"success",showConfirmButton:!1,toast:!0,timer:1500,position:"top"})}catch(g){V.fire({icon:"error",title:"錯誤",text:`${g.response.data.message||"請稍後再試"}`})}finally{u.value=!1,$()}})};return(v,o)=>{const g=T("VLoading");return c(),m(D,null,[e("div",Ie,[a(g,{active:u.value,"is-full-page":!1},null,8,["active"]),o[1]||(o[1]=e("h2",{class:"text-center fw-bold"},"商品管理",-1)),e("div",{class:"mb-8 text-end"},[e("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#ProductModal",onClick:I},"建立商品")]),e("div",Le,[e("table",Re,[o[0]||(o[0]=e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"上架日期"),e("th",null,"分類"),e("th",null,"名稱"),e("th",null,"原價"),e("th",null,"售價"),e("th",null,"啟用"),e("th",{class:"text-end"},"編輯")])],-1)),e("tbody",Be,[(c(!0),m(D,null,S(U.value,n=>(c(),m("tr",{key:n.id},[e("td",null,[e("img",{src:n.imageUrl,alt:`${n.title}的圖片`},null,8,Se)]),e("td",null,_(j(Q)(n.created,"YYYY-MM-DD")),1),e("td",null,_(n.category),1),e("td",null,_(n.title),1),e("td",null,_(n.origin_price),1),e("td",null,_(n.price),1),e("td",null,[n.is_enabled?(c(),m("span",Fe,"啟用")):(c(),m("span",qe,"未啟用"))]),e("td",Ae,[e("div",Oe,[e("button",{type:"button",class:"btn btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#ProductModal",onClick:C=>E(n)},"編輯",8,He),e("button",{type:"button",class:"btn btn-outline-danger",onClick:C=>M(n)}," 刪除 ",8,Ye)])])]))),128))])])])]),a(De,{product:x.value,isNew:w.value,onRefresh:$},null,8,["product","isNew"])],64)}}},Ke=J(ze,[["__scopeId","data-v-2459407c"]]);export{Ke as default};
