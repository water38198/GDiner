import{h as C}from"./moment-Cl4UOzQZ.js";import{_ as $,o as c,c as m,d as a,e as V,b as e,t as _,n as f,g as M,q as k,f as T,r as h,F as w,l as D,s as E,i as N,j as R}from"./index-JINe9Ytb.js";import{P as Y}from"./PaginationComponent-Bx7KWUck.js";var L={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:v,VITE_PATH:y}=L,P={props:{tempCoupon:{type:Object},isNew:{type:Boolean}},emits:["getCoupons"],data(){return{dateTime:"",modalCoupon:{}}},computed:{todayDate(){return C().format("YYYY-MM-DD")}},methods:{showModal(){this.$refs.dialog.showModal()},close(){this.$refs.dialog.close()},autoClose(o){o.target.nodeName==="DIALOG"&&this.$refs.dialog.close()},async confirmCoupon(){const o=this.isNew?"post":"put",t=this.isNew?`${v}/v2/api/${y}/admin/coupon`:`${v}/v2/api/${y}/admin/coupon/${this.modalCoupon.id}`;try{const d=await this.$http[o](t,{data:this.modalCoupon});this.$swal({title:`${d.data.message}`,icon:"success",didClose:()=>{this.$emit("getCoupons")}}),this.close()}catch(d){this.$swal({title:"錯誤發生",text:`${d.response.data.message}`,icon:"error"})}}},watch:{tempCoupon(){this.modalCoupon={...this.tempCoupon},this.modalCoupon.due_date?this.dateTime=C(this.modalCoupon.due_date*1e3).format("YYYY-MM-DD"):this.dateTime=C(new Date().getTime()).format("YYYY-MM-DD"),this.modalCoupon.is_enabled||(this.modalCoupon.is_enabled=0)},dateTime(){this.modalCoupon.due_date=new Date(this.dateTime).getTime()/1e3}}},U={class:"bg-#212529 p-4 flex justify-between items-center"},I={class:"text-white"},z={class:"grid grid-cols-2 gap-6 p-5"},B={class:"input-group"},S=e("label",{for:"name"},"名稱：",-1),A={class:"input-group"},q=e("label",{for:"code"},"優惠碼：",-1),F={class:"input-group"},O=e("label",{for:"due_date"},"到期日：",-1),G={class:"input-group mb-4"},H=e("label",{for:"percent"},"優惠比例：",-1),j={for:"is_paid"},J={class:"text-end p-3 border-t border-solid border-#dee2e6"},K=e("button",{type:"submit",class:"m-1 px-3 py-1.5 text-white bg-#0d6efd border-0 rd hover:cursor-pointer hover:bg-#0b5ed7"},"確定",-1);function Q(o,t,d,r,n,i){const u=h("VField"),p=h("ErrorMessage"),x=h("VForm");return c(),m("dialog",{ref:"dialog",class:"max-w-1140px w-100% border-0 rd p-0 backdrop:backdrop-blur-3",onClick:t[7]||(t[7]=(...s)=>i.autoClose&&i.autoClose(...s))},[a(x,{method:"dialog",onSubmit:i.confirmCoupon},{default:V(({errors:s})=>[e("div",U,[e("h3",I,_(d.isNew?"新增":"編輯"),1),e("button",{type:"button",class:"i-ic:baseline-close p-2 text-white font-size-4 cursor-pointer",onClick:t[0]||(t[0]=(...l)=>i.close&&i.close(...l))})]),e("div",z,[e("div",B,[S,a(u,{type:"text",id:"name",name:"名稱",rules:"required",placeholder:"請輸入名稱",modelValue:n.modalCoupon.title,"onUpdate:modelValue":t[1]||(t[1]=l=>n.modalCoupon.title=l),modelModifiers:{trim:!0},class:f({invalid:s.名稱})},null,8,["modelValue","class"]),a(p,{name:"名稱",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",A,[q,a(u,{type:"text",id:"code",name:"優惠碼",rules:"required",placeholder:"請輸入優惠碼",class:f({invalid:s.優惠碼}),modelValue:n.modalCoupon.code,"onUpdate:modelValue":t[2]||(t[2]=l=>n.modalCoupon.code=l),modelModifiers:{trim:!0}},null,8,["class","modelValue"]),a(p,{name:"優惠碼",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",F,[O,a(u,{type:"date",id:"due_date",name:"到期日",rules:"required",pattern:"yyyy-MM-dd",class:f({invalid:s.到期日}),modelValue:n.dateTime,"onUpdate:modelValue":t[3]||(t[3]=l=>n.dateTime=l),min:i.todayDate},null,8,["class","modelValue","min"]),a(p,{name:"到期日",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",G,[H,a(u,{type:"number",id:"percent",placeholder:"請輸入折扣百分比",name:"優惠比例",rules:"required||max_value:100||min_value:0",modelValue:n.modalCoupon.percent,"onUpdate:modelValue":t[4]||(t[4]=l=>n.modalCoupon.percent=l),modelModifiers:{number:!0},min:"0",class:f({invalid:s.優惠比例}),max:"100"},null,8,["modelValue","class"]),a(p,{name:"優惠比例",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",null,[e("label",j,[M(e("input",{type:"checkbox",id:"is_paid","onUpdate:modelValue":t[5]||(t[5]=l=>n.modalCoupon.is_enabled=l),class:"custom-checkbox","true-value":1,"false-value":0},null,512),[[k,n.modalCoupon.is_enabled]]),T(" 是否啟用 ")])])]),e("div",J,[e("button",{type:"button",class:"m-1 px-3 py-1.5 bg-transparent text-#6c757d border-1 border-solid border-#6c757d rd hover:cursor-pointer hover:bg-#5c636a hover:text-white",onClick:t[6]||(t[6]=(...l)=>i.close&&i.close(...l))},"取消"),K])]),_:1},8,["onSubmit"])],512)}const W=$(P,[["render",Q]]);var X={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:g,VITE_PATH:b}=X,Z={components:{CouponModal:W,PaginationComponent:Y},data(){return{coupons:[],pagination:{},tempCoupon:{},isNew:!1,isLoading:!1}},methods:{async getCoupons(o=1){this.isLoading=!0;try{const t=await this.$http.get(`${g}/v2/api/${b}/admin/coupons?page=${o}`);this.coupons=t.data.coupons,this.pagination=t.data.pagination}catch(t){this.$swal({icon:"error",title:"錯誤發生",text:t.response.data.message})}finally{this.isLoading=!1}},getMoment(o){return C(o).format("YYYY-MM-DD")},addCoupon(){this.isNew=!0,this.tempCoupon={},this.$refs.couponModalRef.showModal()},editCoupon(o){this.tempCoupon=o,this.isNew=!1,this.$refs.couponModalRef.showModal()},async confirmCoupon(o){const t=this.isNew?"post":"put",d=this.isNew?`${g}/v2/api/${b}/admin/coupon`:`${g}/v2/api/${b}/admin/coupon/${o.id}`;try{const r=await this.$http[t](d,{data:o});this.$swal({title:`${r.data.message}`,icon:"success",didClose:()=>{this.getCoupons()}}),this.$refs.couponModalRef.dialog.close()}catch(r){this.$swal({title:"錯誤發生",text:`${r.response.data.message}`,icon:"error",target:"dialog"})}},deleteCoupon(o){const{id:t}=o;this.$swal({title:`你確定要刪除優惠券${o.title}`,icon:"question",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確定"}).then(async d=>{if(d.isConfirmed)try{const r=await this.$http.delete(`${g}/v2/api/${b}/admin/coupon/${t}`);this.$swal({title:`${r.data.message}`,icon:"success",didClose:()=>{this.getCoupons()}}),this.$refs.couponModalRef.dialog.close()}catch(r){console.log(r),this.$swal({title:"錯誤發生",text:`${r.response.data.message}`,icon:"error",target:"dialog"})}})},dateColor(o){const t=Date.now()/1e3;return o-t<0?"text-red":o-t<3*24*60*60?"text-orange":o-t<7*24*60*60&&o-t>3*24*60*60?"text-yellow":"text-green-700"}},mounted(){this.getCoupons()}},ee={class:"p-10 flex flex-col h-100%"},te=e("h2",{class:"font-size-12"},"優惠券",-1),oe={class:"relative min-h-100"},se={class:"text-end mt-6"},ne={class:"w-100% my-6"},ie=e("thead",{class:"border-b-1 border-black border-solid fw-bold text-left"},[e("tr",null,[e("th",{width:"120"}," 名稱 "),e("th",null,"優惠碼"),e("th",null," 到期日 "),e("th",null," 百分比 "),e("th",{width:"100",class:"text-center"}," 是否啟用 "),e("th",{width:"120"}," 編輯 ")])],-1),le={class:"text-center"},ae={key:0,class:"text-#198754"},de={key:1,class:"text-red"},re=["onClick"],ce=["onClick"],ue=R('<ul class="grid gap-2"><li>已過期 : <span class="text-red">紅色</span></li><li>三天之內 : <span class="text-orange">橘色</span></li><li>三到七天內 : <span class="text-yellow">黃色</span></li><li>七天以上 : <span class="text-green-700">綠色</span></li></ul>',1);function pe(o,t,d,r,n,i){const u=h("VLoading"),p=h("PaginationComponent"),x=h("CouponModal");return c(),m(w,null,[e("div",ee,[te,e("div",oe,[a(u,{active:n.isLoading,"is-full-page":!1},null,8,["active"]),e("div",se,[e("button",{type:"button",class:"bg-#0d6efd border-0 text-white cursor-pointer inline-block px-3 py-1.5 rd font-size-4 hover:bg-#0b5ed7",onClick:t[0]||(t[0]=(...s)=>i.addCoupon&&i.addCoupon(...s))},"建立優惠券")]),e("table",ne,[ie,e("tbody",null,[(c(!0),m(w,null,D(n.coupons,s=>(c(),m("tr",{class:"border-b border-#DEE2E6 border-solid",key:s.id},[e("td",null,_(s.title),1),e("td",null,_(s.code),1),e("td",null,[e("span",{class:f(i.dateColor(s.due_date))},_(i.getMoment(s.due_date*1e3)),3)]),e("td",null,_(s.percent),1),e("td",le,[s.is_enabled?(c(),m("span",ae,"啟用")):(c(),m("span",de,"未啟用"))]),e("td",null,[e("div",null,[e("button",{type:"button",class:"text-#0d6efd bg-transparent border-1 border-#0d6efd border-solid rd-tl rd-bl px-2 py-1 hover:bg-#0d6efd hover:text-white hover:cursor-pointer",onClick:l=>i.editCoupon(s)}," 編輯 ",8,re),e("button",{type:"button",class:"text-#dc3545 bg-transparent border-1 border-#de3545 border-solid rd-tr rd-br px-2 py-1 hover:bg-#de3545 hover:text-white hover:cursor-pointer",onClick:l=>i.deleteCoupon(s)}," 刪除 ",8,ce)])])]))),128))])]),ue]),n.coupons.length?(c(),E(p,{key:0,pages:n.pagination,onChangePage:i.getCoupons,class:"mt-auto"},null,8,["pages","onChangePage"])):N("",!0)]),a(x,{"temp-coupon":n.tempCoupon,ref:"couponModalRef","is-new":n.isNew,onGetCoupons:i.getCoupons},null,8,["temp-coupon","is-new","onGetCoupons"])],64)}const fe=$(Z,[["render",pe]]);export{fe as default};
