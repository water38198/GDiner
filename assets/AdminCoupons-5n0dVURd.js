import{r as c,y as B,x as U,o as _,c as f,a as e,b as l,t as g,w as Y,n as $,u as R,k as I,E as S,h as k,M as F,S as b,f as V,e as N,F as T,g as A}from"./index-DuHCPTtL.js";import{a as P}from"./index-C-jDcq-i.js";import{u as E}from"./index-CkGfcHWQ.js";const H={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},O={class:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"},q={class:"modal-content position-absolute"},z={class:"modal-header"},G={class:"modal-title fs-2",id:"CouponModalLabel"},j={class:"modal-body"},J={class:"container-fluid"},K={class:"row gy-4"},Q={class:"col-12 col-md-6"},W={class:"col-12 col-md-6"},X={class:"col-12 col-md-6"},Z={class:"col-12 col-md-6"},ee={class:"col-12"},te={class:"form-check form-switch"},oe={class:"modal-footer"},se=["disabled"],le={__name:"CouponModal",props:{coupon:{type:Object,default:()=>({})},isNew:{type:Boolean,default:!1}},emits:["refresh"],setup(D,{emit:C}){const a=D,y=C,r=c(!1),h=B(()=>a.isNew?"新增優惠券":"編輯優惠券"),o=c({...a.coupon}),x=E(P(),"YYYY-MM-DD"),m=c("");U(()=>a.coupon,s=>{o.value={...s},o.value.due_date?m.value=E(o.value.due_date*1e3,"YYYY-MM-DD").value:m.value=x.value});const n=c(null),i=async()=>{const{VITE_URL:s,VITE_PATH:t}=H,p=a.isNew?"post":"put",v=a.isNew?`${s}/v2/api/${t}/admin/coupon`:`${s}/v2/api/${t}/admin/coupon/${o.value.id}`;r.value=!0,o.value.due_date=new Date(m.value).getTime()/1e3;try{const u=await k[p](v,{data:o.value}),M=F.getInstance(n.value);b.fire({title:u.data.message,icon:"success",showConfirmButton:!1,timer:2e3,didClose:()=>{M.hide(),y("refresh")}})}catch(u){b.fire({icon:"error",title:"錯誤",text:`${u.response.data.message||"請稍後再試"}`})}finally{r.value=!1}};return(s,t)=>{const p=V("VLoading"),v=V("VField"),u=V("ErrorMessage"),M=V("VForm");return _(),f("div",{class:"modal fade",id:"CouponModal",tabindex:"-1","aria-labelledby":"CouponLabel","aria-hidden":"true",ref_key:"modalRef",ref:n},[e("div",O,[e("div",q,[l(p,{active:r.value,"is-full-page":!1},null,8,["active"]),e("div",z,[e("h1",G,g(h.value),1),t[5]||(t[5]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",j,[l(M,{onSubmit:i,id:"couponForm"},{default:Y(({errors:w})=>[e("div",J,[e("div",K,[e("div",Q,[t[6]||(t[6]=e("label",{for:"name",class:"form-label"},"名稱：",-1)),l(v,{type:"text",id:"name",name:"名稱",rules:"required",placeholder:"請輸入名稱",modelValue:o.value.title,"onUpdate:modelValue":t[0]||(t[0]=d=>o.value.title=d),modelModifiers:{trim:!0},class:$(["form-control",{"is-invalid":w.名稱}])},null,8,["modelValue","class"]),l(u,{name:"名稱",class:"invalid-feedback"})]),e("div",W,[t[7]||(t[7]=e("label",{for:"code",class:"form-label"},"優惠碼：",-1)),l(v,{type:"text",id:"code",name:"優惠碼",rules:"required",placeholder:"請輸入優惠碼",class:$(["form-control",{"is-invalid":w.優惠碼}]),modelValue:o.value.code,"onUpdate:modelValue":t[1]||(t[1]=d=>o.value.code=d),modelModifiers:{trim:!0}},null,8,["class","modelValue"]),l(u,{name:"優惠碼",class:"invalid-feedback"})]),e("div",X,[t[8]||(t[8]=e("label",{for:"due_date",class:"form-label"},"到期日：",-1)),l(v,{type:"date",id:"due_date",name:"到期日",rules:"required",pattern:"yyyy-MM-dd",class:$(["form-control",{"is-invalid":w.到期日}]),min:R(x),modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=d=>m.value=d)},null,8,["class","min","modelValue"]),l(u,{name:"到期日",class:"invalid-feedback"})]),e("div",Z,[t[9]||(t[9]=e("label",{for:"percent",class:"form-label"},"折扣比例：",-1)),l(v,{type:"number",id:"percent",placeholder:"請輸入折扣百分比",name:"折扣比例",rules:"required||max_value:100||min_value:0",modelValue:o.value.percent,"onUpdate:modelValue":t[3]||(t[3]=d=>o.value.percent=d),modelModifiers:{number:!0},min:"0",class:$(["form-control",{invalid:w.折扣比例}]),max:"100"},null,8,["modelValue","class"]),l(u,{name:"折扣比例",class:"invalid-feedback"})]),e("div",ee,[e("div",te,[I(e("input",{class:"form-check-input",type:"checkbox",role:"switch","onUpdate:modelValue":t[4]||(t[4]=d=>o.value.is_enabled=d),id:"is_enabled","true-value":1,"false-value":0},null,512),[[S,o.value.is_enabled]]),t[10]||(t[10]=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1))])])])])]),_:1})]),e("div",oe,[t[11]||(t[11]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),e("button",{type:"submit",class:"btn btn-primary",form:"couponForm",disabled:r.value},"送出",8,se)])])])],512)}}},L={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},ae={class:"position-relative container min-vh-100 py-10"},ne={class:"table-responsive"},ie={class:"table align-middle text-nowrap"},de={class:"table-group-divider"},re={key:0,class:"text-success"},ue={key:1,class:"text-danger"},ce={class:"text-end"},me={class:"btn-group text-nowrap"},pe=["onClick"],ve=["onClick"],ye={__name:"AdminCoupons",setup(D){const C=c([]),a=c(!1),y=async()=>{const{VITE_URL:n,VITE_PATH:i}=L;try{a.value=!0;const s=await k.get(`${n}/v2/api/${i}/admin/coupons`);C.value=s.data.coupons}catch(s){b.fire({icon:"error",title:"錯誤",text:`${s.response.data.message||"請稍後再試"}`})}finally{a.value=!1}};N(()=>{y()});const r=c({}),h=c(!0),o=()=>{h.value=!0,r.value={is_enabled:1}},x=n=>{h.value=!1,r.value={...n}},m=n=>{b.fire({title:`確定要刪除優惠券${n.title}嗎？`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",confirmButtonColor:"#d33",cancelButtonText:"取消"}).then(async i=>{if(i.isConfirmed)try{a.value=!0;const{VITE_URL:s,VITE_PATH:t}=L,p=await k.delete(`${s}/v2/api/${t}/admin/coupon/${n.id}`);b.fire({title:p.data.message,icon:"success",showConfirmButton:!1,timer:2e3,didClose:()=>{y()}})}catch(s){b.fire({icon:"error",title:"錯誤",text:`${s.response.data.message||"請稍後再試"}`})}finally{a.value=!1}})};return(n,i)=>{const s=V("VLoading");return _(),f(T,null,[e("div",ae,[l(s,{active:a.value,"is-full-page":!1},null,8,["active"]),i[1]||(i[1]=e("h2",{class:"text-center fw-bold"},"優惠券",-1)),e("div",{class:"mb-8 text-end"},[e("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#CouponModal",onClick:o},"建立優惠券")]),e("div",ne,[e("table",ie,[i[0]||(i[0]=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"優惠碼"),e("th",null,"到期日"),e("th",null,"折扣"),e("th",null,"啟用"),e("th",{class:"text-end"},"編輯")])],-1)),e("tbody",de,[(_(!0),f(T,null,A(C.value,t=>(_(),f("tr",{key:t.id},[e("td",null,g(t.title),1),e("td",null,g(t.code),1),e("td",null,g(R(E)(t.due_date*1e3,"YYYY-MM-DD")),1),e("td",null,g(t.percent),1),e("td",null,[t.is_enabled?(_(),f("span",re,"啟用")):(_(),f("span",ue,"未啟用"))]),e("td",ce,[e("div",me,[e("button",{type:"button",class:"btn btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#CouponModal",onClick:p=>x(t)},"編輯",8,pe),e("button",{type:"button",class:"btn btn-outline-danger",onClick:p=>m(t)},"刪除",8,ve)])])]))),128))])])])]),l(le,{coupon:r.value,"is-new":h.value,onRefresh:y},null,8,["coupon","is-new"])],64)}}};export{ye as default};
