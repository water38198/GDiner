import{_ as L,M as I,o as n,c,b as t,t as _,d as i,w as y,n as p,g as V,F as b,j as U,f as T,v as C,l as M,r as h,q as S,p as D,i as $}from"./index-Cd9JHZzw.js";import{P as R}from"./PaginationComponent-BJryJdVF.js";var q={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:w,VITE_PATH:x}=q,B={props:{tempProduct:{type:Object},isNew:Boolean},emits:["getProducts"],data(){return{modalProduct:{},newTag:"",modal:null,isLoading:!1}},methods:{addNewImages(){this.modalProduct.imagesUrl||(this.modalProduct.imagesUrl=[]);const l=this.modalProduct.imagesUrl.length;this.modalProduct.imagesUrl[l-1]!==""&&this.modalProduct.imagesUrl.push("")},async upload(l,e){const r=e.target.files[0],f=new FormData;f.append("file-to-upload",r);try{const o=await this.$http.post(`${w}/v2/api/${x}/admin/upload`,f);if(this.addNewImages(),l==="images"){const d=this.modalProduct.imagesUrl.length;this.modalProduct.imagesUrl[d-1]=o.data.imageUrl}else l==="image"&&(this.modalProduct.imageUrl=o.data.imageUrl);e.target.value=""}catch(o){this.$swal({icon:"error",title:"錯誤發生",text:o.response.data.message})}},addTag(){if(this.newTag==="")return;this.modalProduct.tags||(this.modalProduct.tags=[]);const l=this.modalProduct.tags.length,e=this.modalProduct.tags[l-1]||"";this.newTag===e||e===void 0||(this.modalProduct.tags.push(this.newTag),this.newTag="")},deleteTag(l){this.modalProduct.tags=this.modalProduct.tags.filter(e=>e!==l)},async confirmProduct(){this.isLoading=!0;const l=this.isNew?"post":"put",e=this.isNew?`${w}/v2/api/${x}/admin/product`:`${w}/v2/api/${x}/admin/product/${this.modalProduct.id}`;this.isNew&&(this.modalProduct.created=Date.now());try{const r=await this.$http[l](e,{data:this.modalProduct});this.$swal({title:`${r.data.message}`,icon:"success",didClose:()=>{this.modal.hide(),this.$emit("getProducts")}})}catch(r){this.$swal({icon:"error",title:"錯誤發生",text:`${r.response.data.message}`})}finally{this.isLoading=!1}}},watch:{tempProduct(){this.modalProduct={...this.tempProduct}}},mounted(){this.modal=new I("#ProductModal")}},F={class:"modal fade",id:"ProductModal",tabindex:"-1","aria-labelledby":"ProductLabel","aria-hidden":"true"},A={class:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"},O={class:"modal-content"},H={class:"modal-header"},G={class:"modal-title fs-2",id:"ProductModalLabel"},z=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},J={class:"row gy-6"},K={class:"col-md-4"},Q=t("label",{for:"imagUrl",class:"form-label"},"主要圖片",-1),W=["src"],X={action:"/api/thisismycourse2/admin/upload",enctype:"multipart/form-data",method:"post",class:"my-4"},Y={class:"mt-10"},Z=t("h4",{class:"mb-4 fs-6"},"多圖新增",-1),tt={class:"d-flex align-items-center mb-2"},et={for:"images-1",class:"form-la"},ot=["onClick"],st=t("i",{class:"bi bi-x"},null,-1),lt=[st],at={class:"input-group mb-2"},it=["onUpdate:modelValue"],dt=["src"],nt={action:"/api/thisismycourse2/admin/upload",enctype:"multipart/form-data",method:"post",class:"mt-6"},rt={class:"col-md-8"},ct={class:"row g-2"},ut=t("label",{for:"title",class:"form-label"},"名稱：",-1),mt={class:"col-6"},pt=t("label",{for:"category",class:"form-label"},"分類：",-1),_t=t("option",{value:"主食"},"主食",-1),gt=t("option",{value:"沙拉"},"沙拉",-1),ht=t("option",{value:"湯品"},"湯品",-1),ft=t("option",{value:"副食"},"副食",-1),bt=t("option",{value:"甜點"},"甜點",-1),Pt=t("option",{value:"飲料"},"飲料",-1),vt=t("option",{value:"套餐"},"套餐",-1),yt={class:"col-6"},wt=t("label",{for:"unit",class:"form-label"},"單位：",-1),xt=t("datalist",{id:"units"},[t("option",{value:"碗"}),t("option",{value:"客"}),t("option",{value:"杯"}),t("option",{value:"份"}),t("option",{value:"個"})],-1),Vt={class:"col-6"},Ut=t("label",{for:"origin_price",class:"form-label"},"原價：",-1),Tt={class:"col-6"},Ct=t("label",{for:"price",class:"form-label"},"售價：",-1),kt={class:"col-6"},Nt=t("label",{for:"veggie",class:"form-label"},"素食:",-1),Lt=t("option",{value:"全素",class:"text-success"},"全素",-1),Et=t("option",{value:"蛋奶素",class:"text-warning"},"蛋奶素",-1),It=t("option",{value:"葷食",class:"text-danger"},"葷食",-1),Mt=t("label",{for:"tags",class:"form-label"},"標籤：",-1),St={class:"input-group"},Dt={class:"mb-2"},$t=t("p",null,"目前標籤：",-1),Rt={key:0,class:"list-unstyled d-flex"},qt=["onClick"],Bt=t("label",{for:"description",class:"form-label"},"產品敘述:",-1),Ft=t("label",{for:"content",class:"form-label"},"內容說明:",-1),At={class:"modal-footer"},Ot=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),Ht=["disabled"];function Gt(l,e,r,f,o,d){const u=h("VField"),m=h("ErrorMessage"),P=h("VForm");return n(),c("div",F,[t("div",A,[t("div",O,[t("div",H,[t("h1",G,_(r.isNew?"新增產品":"編輯產品"),1),z]),t("div",j,[i(P,{onSubmit:d.confirmProduct,id:"ProductForm"},{default:y(({errors:a})=>[t("div",J,[t("div",K,[t("div",null,[Q,i(u,{name:"主要圖片",id:"imageUrl",type:"text",placeholder:"請輸入圖片連結",modelValue:o.modalProduct.imageUrl,"onUpdate:modelValue":e[0]||(e[0]=s=>o.modalProduct.imageUrl=s),class:p(["form-control",{"is-invalid":a.主要圖片}]),rules:"required"},null,8,["modelValue","class"]),i(m,{name:"主要圖片",class:"text-danger ms-3"}),o.modalProduct.imageUrl?(n(),c("img",{key:0,src:o.modalProduct.imageUrl,alt:"產品主要照片"},null,8,W)):V("",!0),t("form",X,[t("input",{type:"file",name:"file-to-upload",onChange:e[1]||(e[1]=s=>d.upload("image",s)),class:"form-control"},null,32)])]),t("div",Y,[Z,(n(!0),c(b,null,U(o.modalProduct.imagesUrl,(s,g)=>(n(),c("div",{key:s,class:"mb-4"},[t("div",tt,[t("label",et,"圖片網址"+_(g+1),1),t("button",{type:"button",class:"fs-4 ms-auto",onClick:v=>o.modalProduct.imagesUrl.splice(g,1)},lt,8,ot)]),t("div",at,[T(t("input",{type:"text","onUpdate:modelValue":v=>o.modalProduct.imagesUrl[g]=v,placeholder:"請輸入圖片網址",class:"form-control"},null,8,it),[[C,o.modalProduct.imagesUrl[g]]])]),t("img",{src:s,alt:"產品照片"},null,8,dt)]))),128)),t("button",{type:"button",class:"btn btn-outline-primary w-100",onClick:e[2]||(e[2]=(...s)=>d.addNewImages&&d.addNewImages(...s))}," 新增圖片網址 "),t("form",nt,[t("input",{type:"file",name:"file-to-upload",onChange:e[3]||(e[3]=s=>d.upload("images",s)),class:"form-control"},null,32)])])]),t("div",rt,[t("div",ct,[t("div",null,[ut,i(u,{type:"text",id:"title",name:"名稱",rules:"required",placeholder:"請輸入標題",modelValue:o.modalProduct.title,"onUpdate:modelValue":e[4]||(e[4]=s=>o.modalProduct.title=s),class:p(["form-control",{"is-invalid":a.名稱}])},null,8,["modelValue","class"]),i(m,{name:"名稱",class:"text-danger ps-3"})]),t("div",mt,[pt,i(u,{as:"select",name:"分類",rules:"required",id:"category",class:p(["form-select",{"is-invalid":a.分類}]),modelValue:o.modalProduct.category,"onUpdate:modelValue":e[5]||(e[5]=s=>o.modalProduct.category=s)},{default:y(()=>[_t,gt,ht,ft,bt,Pt,vt]),_:2},1032,["class","modelValue"]),i(m,{name:"分類",class:"text-danger ps-3"})]),t("div",yt,[wt,i(u,{type:"text",id:"unit",placeholder:"請輸入單位",modelValue:o.modalProduct.unit,"onUpdate:modelValue":e[6]||(e[6]=s=>o.modalProduct.unit=s),list:"units",name:"單位",rules:"required",class:p(["form-control",{"is-invalid":a.單位}]),autocomplete:"off"},null,8,["modelValue","class"]),xt,i(m,{name:"單位",class:"text-danger ps-3"})]),t("div",Vt,[Ut,i(u,{type:"number",name:"原價",id:"origin_price",placeholder:"請輸入原價",min:"0",rules:"required|min_value:0",class:p(["form-control",{"is-invalid":a.原價}]),modelValue:o.modalProduct.origin_price,"onUpdate:modelValue":e[7]||(e[7]=s=>o.modalProduct.origin_price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),i(m,{name:"原價",class:"text-danger ps-3"})]),t("div",Tt,[Ct,i(u,{type:"number",id:"price",placeholder:"請輸入售價",min:"0",modelValue:o.modalProduct.price,"onUpdate:modelValue":e[8]||(e[8]=s=>o.modalProduct.price=s),modelModifiers:{number:!0},name:"售價",rules:{required:!0,max_value:o.modalProduct.origin_price,min_value:0},class:p(["form-control",{"is-invalid":a.售價}])},null,8,["modelValue","rules","class"]),i(m,{name:"售價",class:"text-danger ps-3"})]),t("div",kt,[Nt,i(u,{as:"select",id:"veggie",modelValue:o.modalProduct.veggie,"onUpdate:modelValue":e[9]||(e[9]=s=>o.modalProduct.veggie=s),name:"素食",rules:"required",class:p(["form-select",{"is-invalid":a.素食}])},{default:y(()=>[Lt,Et,It]),_:2},1032,["modelValue","class"]),i(m,{name:"素食",class:"text-danger ps-3"})]),t("div",null,[Mt,t("div",St,[T(t("input",{type:"text",id:"tags","onUpdate:modelValue":e[10]||(e[10]=s=>o.newTag=s),onKeydown:e[11]||(e[11]=M((...s)=>d.addTag&&d.addTag(...s),["enter"])),class:"form-control"},null,544),[[C,o.newTag,void 0,{trim:!0}]]),t("button",{type:"button",class:"btn btn-outline-primary",onClick:e[12]||(e[12]=(...s)=>d.addTag&&d.addTag(...s))}," 新增標籤 ")])]),t("div",Dt,[$t,o.modalProduct.tags?(n(),c("ul",Rt,[(n(!0),c(b,null,U(o.modalProduct.tags,(s,g)=>(n(),c("li",{key:`${g}+${s}`},[t("button",{class:"btn btn-outline-primary",onClick:v=>d.deleteTag(s)},_(s),9,qt)]))),128))])):V("",!0)]),t("div",null,[Bt,i(u,{as:"textarea",id:"description",rows:"6",modelValue:o.modalProduct.description,"onUpdate:modelValue":e[13]||(e[13]=s=>o.modalProduct.description=s),name:"產品敘述",rules:"required",class:p(["form-control",{"is-invalid":a.產品敘述}])},null,8,["modelValue","class"]),i(m,{name:"產品敘述",class:"text-danger ps-3"})]),t("div",null,[Ft,i(u,{as:"textarea",id:"content",rows:"4",class:p(["form-control",{"is-invalid":a.內容說明}]),modelValue:o.modalProduct.content,"onUpdate:modelValue":e[14]||(e[14]=s=>o.modalProduct.content=s),name:"內容說明",rules:"required"},null,8,["modelValue","class"]),i(m,{name:"內容說明",class:"text-danger ps-3"})])])])])]),_:1},8,["onSubmit"])]),t("div",At,[Ot,t("button",{type:"submit",class:"btn btn-primary",form:"ProductForm",disabled:o.isLoading},"送出",8,Ht)])])])])}const zt=L(B,[["render",Gt]]);var jt={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:k,VITE_PATH:N}=jt,Jt={components:{ProductModal:zt,PaginationComponent:R},data(){return{products:[],tempProduct:{},isNew:!0,pagination:{},isLoading:!1}},methods:{async getProducts(l=1){this.isLoading=!0;try{const e=await this.$http.get(`${k}/v2/api/${N}/admin/products?page=${l}`);this.products=e.data.products,this.pagination=e.data.pagination}catch(e){this.$swal({icon:"error",title:"錯誤發生",text:e.response.data.message})}finally{this.isLoading=!1}},addNewProduct(){this.isNew=!0,this.tempProduct={}},editProduct(l){this.tempProduct=JSON.parse(JSON.stringify(l)),this.isNew=!1},deleteProduct(l){this.$swal({title:`你確定要刪除 ${l.title} 嗎?`,showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(async e=>{if(e.isConfirmed)try{const r=await this.$http.delete(`${k}/v2/api/${N}/admin/product/${l.id}`);this.$swal({icon:"success",text:r.data.message,didClose:()=>{this.getProducts(this.pagination.current_page||1)}})}catch(r){this.$swal({icon:"error",text:r.response.data.message})}})}},mounted(){this.getProducts()}},E=l=>(D("data-v-7808a513"),l=l(),$(),l),Kt={class:"py-4 py-md-10"},Qt=E(()=>t("h2",{class:"text-center fs-1"},"產品",-1)),Wt={class:"text-end mt-6"},Xt={class:"table-responsive"},Yt={class:"table mt-6 text-nowrap align-middle"},Zt=E(()=>t("thead",null,[t("tr",null,[t("th",null,"縮圖"),t("th",null,"分類"),t("th",null,"產品名稱"),t("th",{class:"text-end"},"原價"),t("th",{class:"text-end"},"售價"),t("th",{class:"text-center"},"是否啟用"),t("th",{class:"text-center",width:"120"},"編輯")])],-1)),te={class:"table-group-divider"},ee=["src","alt"],oe={class:"text-end"},se={class:"text-end"},le={class:"text-center"},ae={key:0,class:"text-#198754"},ie={key:1,class:"text-red"},de={class:"text-end"},ne={class:"btn-group text-nowrap",role:"group","aria-label":"edit button group"},re=["onClick"],ce=["onClick"];function ue(l,e,r,f,o,d){const u=h("VLoading"),m=h("ProductModal"),P=h("PaginationComponent");return n(),c(b,null,[i(u,{active:o.isLoading},null,8,["active"]),t("div",Kt,[Qt,t("div",Wt,[t("button",{type:"button",class:"btn btn-primary px-3 py-2",onClick:e[0]||(e[0]=(...a)=>d.addNewProduct&&d.addNewProduct(...a)),"data-bs-toggle":"modal","data-bs-target":"#ProductModal"},"建立新的產品")]),t("div",Xt,[t("table",Yt,[Zt,t("tbody",te,[(n(!0),c(b,null,U(o.products,a=>(n(),c("tr",{key:a.id},[t("td",null,[t("img",{src:a.imageUrl,alt:`${a.title}的圖片`,class:"product-image rounded-2"},null,8,ee)]),t("td",null,_(a.category),1),t("td",null,_(a.title),1),t("td",oe,_(a.origin_price),1),t("td",se,_(a.price),1),t("td",le,[a.is_enabled?(n(),c("span",ae,"啟用")):(n(),c("span",ie,"未啟用"))]),t("td",de,[t("div",ne,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:s=>d.editProduct(a),"data-bs-toggle":"modal","data-bs-target":"#ProductModal"}," 編輯 ",8,re),t("button",{type:"button",class:"btn btn-outline-danger",onClick:s=>d.deleteProduct(a)}," 刪除 ",8,ce)])])]))),128))])])])]),i(m,{onGetProducts:d.getProducts,"temp-product":o.tempProduct,"is-new":o.isNew,ref:"dialog"},null,8,["onGetProducts","temp-product","is-new"]),o.products.length?(n(),S(P,{key:0,pages:o.pagination,onChangePage:d.getProducts},null,8,["pages","onChangePage"])):V("",!0)],64)}const _e=L(Jt,[["render",ue],["__scopeId","data-v-7808a513"]]);export{_e as default};
