import{r as c,m as R,l as U,o as v,c as _,a as e,b as s,t as h,w as Y,n as w,u as B,k as I,H as N,h as k,M as S,S as f,f as y,e as F,F as T,g as A,B as P,x as H}from"./index-DeJfmtbo.js";import{a as O}from"./index-Dsg3z6B6.js";import{u as D}from"./index-CO1L_0eG.js";import{_ as q}from"./PaginationComponent-BS_lQwJQ.js";const z={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},G={class:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"},j={class:"modal-content position-absolute"},J={class:"modal-header"},K={class:"modal-title fs-2",id:"CouponModalLabel"},Q={class:"modal-body"},W={class:"container-fluid"},X={class:"row gy-4"},Z={class:"col-12 col-md-6"},ee={class:"col-12 col-md-6"},te={class:"col-12 col-md-6"},oe={class:"col-12 col-md-6"},ae={class:"col-12"},le={class:"form-check form-switch"},se={class:"modal-footer"},ne=["disabled"],ie={__name:"CouponModal",props:{coupon:{type:Object,default:()=>({})},isNew:{type:Boolean,default:!1}},emits:["refresh"],setup(E,{emit:V}){const n=E,b=V,d=c(!1),g=R(()=>n.isNew?"新增優惠券":"編輯優惠券"),o=c({...n.coupon}),C=D(O(),"YYYY-MM-DD"),p=c("");U(()=>n.coupon,a=>{o.value={...a},o.value.due_date?p.value=D(o.value.due_date*1e3,"YYYY-MM-DD").value:p.value=C.value});const x=c(null),r=async()=>{const{VITE_URL:a,VITE_PATH:t}=z,l=n.isNew?"post":"put",i=n.isNew?`${a}/v2/api/${t}/admin/coupon`:`${a}/v2/api/${t}/admin/coupon/${o.value.id}`;d.value=!0,o.value.due_date=new Date(p.value).getTime()/1e3;try{const m=await k[l](i,{data:o.value}),M=S.getInstance(x.value);f.fire({title:m.data.message,icon:"success",showConfirmButton:!1,timer:2e3,didClose:()=>{M.hide(),b("refresh")}})}catch(m){f.fire({icon:"error",title:"錯誤",text:`${m.response.data.message||"請稍後再試"}`})}finally{d.value=!1}};return(a,t)=>{const l=y("VLoading"),i=y("VField"),m=y("ErrorMessage"),M=y("VForm");return v(),_("div",{class:"modal fade",id:"CouponModal",tabindex:"-1","aria-labelledby":"CouponLabel","aria-hidden":"true",ref_key:"modalRef",ref:x},[e("div",G,[e("div",j,[s(l,{active:d.value,"is-full-page":!1},null,8,["active"]),e("div",J,[e("h1",K,h(g.value),1),t[5]||(t[5]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Q,[s(M,{onSubmit:r,id:"couponForm"},{default:Y(({errors:$})=>[e("div",W,[e("div",X,[e("div",Z,[t[6]||(t[6]=e("label",{for:"name",class:"form-label"},"名稱：",-1)),s(i,{type:"text",id:"name",name:"名稱",rules:"required",placeholder:"請輸入名稱",modelValue:o.value.title,"onUpdate:modelValue":t[0]||(t[0]=u=>o.value.title=u),modelModifiers:{trim:!0},class:w(["form-control",{"is-invalid":$.名稱}])},null,8,["modelValue","class"]),s(m,{name:"名稱",class:"invalid-feedback"})]),e("div",ee,[t[7]||(t[7]=e("label",{for:"code",class:"form-label"},"優惠碼：",-1)),s(i,{type:"text",id:"code",name:"優惠碼",rules:"required",placeholder:"請輸入優惠碼",class:w(["form-control",{"is-invalid":$.優惠碼}]),modelValue:o.value.code,"onUpdate:modelValue":t[1]||(t[1]=u=>o.value.code=u),modelModifiers:{trim:!0}},null,8,["class","modelValue"]),s(m,{name:"優惠碼",class:"invalid-feedback"})]),e("div",te,[t[8]||(t[8]=e("label",{for:"due_date",class:"form-label"},"到期日：",-1)),s(i,{type:"date",id:"due_date",name:"到期日",rules:"required",pattern:"yyyy-MM-dd",class:w(["form-control",{"is-invalid":$.到期日}]),min:B(C),modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=u=>p.value=u)},null,8,["class","min","modelValue"]),s(m,{name:"到期日",class:"invalid-feedback"})]),e("div",oe,[t[9]||(t[9]=e("label",{for:"percent",class:"form-label"},"折扣比例：",-1)),s(i,{type:"number",id:"percent",placeholder:"請輸入折扣百分比",name:"折扣比例",rules:"required||max_value:100||min_value:0",modelValue:o.value.percent,"onUpdate:modelValue":t[3]||(t[3]=u=>o.value.percent=u),modelModifiers:{number:!0},min:"0",class:w(["form-control",{invalid:$.折扣比例}]),max:"100"},null,8,["modelValue","class"]),s(m,{name:"折扣比例",class:"invalid-feedback"})]),e("div",ae,[e("div",le,[I(e("input",{class:"form-check-input",type:"checkbox",role:"switch","onUpdate:modelValue":t[4]||(t[4]=u=>o.value.is_enabled=u),id:"is_enabled","true-value":1,"false-value":0},null,512),[[N,o.value.is_enabled]]),t[10]||(t[10]=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1))])])])])]),_:1})]),e("div",se,[t[11]||(t[11]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),e("button",{type:"submit",class:"btn btn-primary",form:"couponForm",disabled:d.value},"送出",8,ne)])])])],512)}}},L={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},de={class:"position-relative container min-vh-100 py-10"},re={class:"table-responsive"},ue={class:"table align-middle text-nowrap"},ce={class:"table-group-divider"},me={key:0,class:"text-success"},pe={key:1,class:"text-danger"},ve={class:"text-end"},_e={class:"btn-group text-nowrap"},fe=["onClick"],be=["onClick"],Ce={__name:"AdminCoupons",setup(E){const V=c([]),n=c(!1),b=c({}),d=async()=>{const{VITE_URL:r,VITE_PATH:a}=L;try{n.value=!0;const t=await k.get(`${r}/v2/api/${a}/admin/coupons`);V.value=t.data.coupons,b.value=t.data.pagination}catch(t){f.fire({icon:"error",title:"錯誤",text:`${t.response.data.message||"請稍後再試"}`})}finally{n.value=!1}};F(()=>{d()});const g=c({}),o=c(!0),C=()=>{o.value=!0,g.value={is_enabled:1}},p=r=>{o.value=!1,g.value={...r}},x=r=>{f.fire({title:`確定要刪除優惠券${r.title}嗎？`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",confirmButtonColor:"#d33",cancelButtonText:"取消"}).then(async a=>{if(a.isConfirmed)try{n.value=!0;const{VITE_URL:t,VITE_PATH:l}=L,i=await k.delete(`${t}/v2/api/${l}/admin/coupon/${r.id}`);f.fire({title:i.data.message,icon:"success",showConfirmButton:!1,timer:2e3,didClose:()=>{d()}})}catch(t){f.fire({icon:"error",title:"錯誤",text:`${t.response.data.message||"請稍後再試"}`})}finally{n.value=!1}})};return(r,a)=>{const t=y("VLoading");return v(),_(T,null,[e("div",de,[s(t,{active:n.value,"is-full-page":!1},null,8,["active"]),a[1]||(a[1]=e("h2",{class:"text-center fw-bold"},"優惠券",-1)),e("div",{class:"mb-8 text-end"},[e("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#CouponModal",onClick:C},"建立優惠券")]),e("div",re,[e("table",ue,[a[0]||(a[0]=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"優惠碼"),e("th",null,"到期日"),e("th",null,"折扣"),e("th",null,"啟用"),e("th",{class:"text-end"},"編輯")])],-1)),e("tbody",ce,[(v(!0),_(T,null,A(V.value,l=>(v(),_("tr",{key:l.id},[e("td",null,h(l.title),1),e("td",null,h(l.code),1),e("td",null,h(B(D)(l.due_date*1e3,"YYYY-MM-DD")),1),e("td",null,h(l.percent),1),e("td",null,[l.is_enabled?(v(),_("span",me,"啟用")):(v(),_("span",pe,"未啟用"))]),e("td",ve,[e("div",_e,[e("button",{type:"button",class:"btn btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#CouponModal",onClick:i=>p(l)},"編輯",8,fe),e("button",{type:"button",class:"btn btn-outline-danger",onClick:i=>x(l)},"刪除",8,be)])])]))),128))])])]),b.value.total_pages>1?(v(),P(q,{key:0,pagination:b.value,onChangePage:d},null,8,["pagination"])):H("",!0)]),s(ie,{coupon:g.value,"is-new":o.value,onRefresh:d},null,8,["coupon","is-new"])],64)}}};export{Ce as default};
