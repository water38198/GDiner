import{_ as F,j as x,s as T,f as y,o as m,c as p,b as a,u as n,a as e,F as w,g as B,t as g,k,v as N,r as h,l as j,m as O,p as U,q as P,w as E,n as $,x as S,y as q,h as A,S as R,d as z,R as H}from"./index-DeJfmtbo.js";const G={class:"position-relative"},Q={class:"d-flex justify-content-between align-items-center"},J={class:"table align-middle"},K={class:"table-group-divider border-bottom border-primary"},W={class:"product-image"},X=["src","alt"],Y={class:"product-info"},Z={class:"d-flex flex-column justify-content-between"},I={class:"fs-5 fs-md-3"},ee={class:"text-info"},te={class:"text-primary text-opacity-75"},se={class:"product-qty"},oe={class:"d-flex align-items-center gap-2"},le={class:"position-relative border-custom"},ae=["disabled","onClick"],ne=["onUpdate:modelValue","onChange","disabled"],re=["disabled","onClick"],ie=["onClick"],de={class:"product-total text-end"},ue={__name:"CartTable",setup(C){const o=x(),{cart:u,cartLoading:c}=T(o),{clearCart:d,deleteCartItem:_,updateCartItem:v}=x(),b=(t,l)=>{let r=parseInt(l.target.value)<1||isNaN(parseInt(l.target.value))?1:parseInt(l.target.value);v(t,r)};return(t,l)=>{const r=y("VLoading");return m(),p("div",G,[a(r,{active:n(c),"is-full-page":!1},null,8,["active"]),e("div",Q,[l[1]||(l[1]=e("h2",{class:"fw-bold"},"購物車",-1)),e("button",{type:"button",class:"bg-transparent border-0 text-primary text-decoration-underline",onClick:l[0]||(l[0]=(...s)=>n(d)&&n(d)(...s))},"清空購物車")]),e("table",J,[l[3]||(l[3]=e("thead",{class:"thead"},[e("tr",null,[e("th",null,"商品"),e("th",{class:"d-none d-md-table-cell"}),e("th",{class:"d-none d-md-table-cell"},"數量"),e("th",{class:"text-end"},"小計")])],-1)),e("tbody",K,[(m(!0),p(w,null,B(n(u).carts,s=>(m(),p("tr",{key:s.id,class:"product-row"},[e("td",W,[e("img",{src:s.product.imageUrl,alt:`${s.product.title}的照片`,class:"border border-primary"},null,8,X)]),e("td",Y,[e("div",Z,[e("h3",I,g(s.product.title),1),e("span",ee,g(s.product.category),1),e("span",te,"$"+g(s.product.price),1)])]),e("td",se,[e("div",oe,[e("div",le,[e("button",{type:"button",class:"position-absolute h-100 start-0 border-0 bg-transparent ps-4",disabled:n(c),onClick:f=>n(v)(s,s.qty-1)},"-",8,ae),k(e("input",{type:"number",name:"qty",id:"qty","onUpdate:modelValue":f=>s.qty=f,onChange:f=>b(s,f),class:"bg-secondary rounded",disabled:n(c)},null,40,ne),[[N,s.qty]]),e("button",{type:"button",class:"position-absolute h-100 end-0 border-0 bg-transparent pe-4",disabled:n(c),onClick:f=>n(v)(s,s.qty+1)},"+",8,re)]),e("button",{class:"btn btn-primary",onClick:f=>n(_)(s)},l[2]||(l[2]=[e("i",{class:"bi bi-trash3"},null,-1)]),8,ie)])]),e("td",de," $"+g(s.final_total),1)]))),128))])])])}}},ce=F(ue,[["__scopeId","data-v-4e209fe5"]]),me={class:"position-relative"},pe={class:"coupon mb-8"},_e={class:"text-end"},ve={key:0,class:"text-end"},fe={class:"text-danger"},be={class:"text-end"},ge={class:"text-end"},ye={class:"pb-4 text-end"},he={__name:"CartCoupon",props:{userForm:{type:Object,required:!0}},setup(C){const o=x(),u=h(""),c=h(!1),d=()=>{c.value=!c.value},_=h(!1),v=async r=>{_.value=!0,await o.submitCoupon(r),_.value=!1},b=C,t=h(b.userForm);j(()=>b.userForm,r=>{t.value=r});const l=O(()=>{let r=0;return t.value.user.type==="外帶"&&(r=60),o.cart.final_total>=1e3&&(r=0),r});return(r,s)=>{const f=y("VLoading"),V=y("VField"),i=y("ErrorMessage"),D=y("VForm");return m(),p(w,null,[e("div",me,[a(f,{active:_.value,"is-full-page":!1},null,8,["active"]),e("div",pe,[k(e("p",_e,[e("a",{class:"text-decoration-underline link-opacity-75-hover",href:"#",onClick:P(d,["prevent"])},"優惠券")],512),[[U,!c.value]]),k(e("div",null,[a(D,{onSubmit:s[1]||(s[1]=L=>v(u.value)),autocomplete:"off",class:"d-flex gap-2 justify-content-end"},{default:E(({errors:L})=>[e("div",null,[a(V,{type:"text",class:$(["form-control border-custom",{"is-invalid":L.優惠券}]),name:"優惠券",id:"優惠券",rules:"required",placeholder:"請輸入優惠券代碼",modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=M=>u.value=M)},null,8,["class","modelValue"]),a(i,{name:"優惠券",class:"invalid-feedback"})]),s[2]||(s[2]=e("button",{class:"btn btn-outline-primary text-nowrap",type:"submit"},"使用",-1))]),_:1})],512),[[U,c.value]])]),n(o).cart.carts[0].coupon?(m(),p("div",ve,[e("p",null,"已套用優惠券："+g(n(o).cart.carts[0].coupon.code),1),e("p",fe,"折扣金額： "+g(n(o).cart.final_total-n(o).cart.total),1)])):S("",!0),e("p",be,"餐點總額："+g(n(o).cart.final_total),1),e("p",ge,"運費："+g(l.value),1),e("h3",ye,"總計：$ "+g(n(o).cart.final_total+l.value),1)]),s[3]||(s[3]=e("hr",null,null,-1))],64)}}},Ve=F(he,[["__scopeId","data-v-2d607333"]]),$e={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},xe={class:"position-relative container"},ke={class:"container"},Ce={class:"mb-8 row gy-8"},we={class:"col-12 col-md-8"},Fe={class:"row gy-8"},Ee={class:"col-12"},Se={class:"form-floating"},Le={class:"col-6"},Ue={class:"form-floating"},qe={class:"col-6"},Re={class:"form-floating"},Te={class:"col-12"},Be={class:"form-floating"},De={class:"col-12 col-md-4"},Me={class:"border-custom p-4 fs-5"},Ne={class:"form-check"},je={class:"form-check"},Oe={key:0,class:"mt-4"},Pe={class:"form-floating"},Ae={id:"list"},ze=["value"],He={__name:"CartForm",setup(C){const o=h({user:{email:"",name:"",tel:"",address:"阿橘飯店",type:"內用",seat_number:""},message:""}),u=h(null),c=b=>/^(09)[0-9]{8}$/.test(b)?!0:"請輸入正確的電話號碼",d=h(!1),_=x(),v=async()=>{const{VITE_URL:b,VITE_PATH:t}=$e;try{d.value=!0;const l=await A.post(`${b}/v2/api/${t}/order`,{data:o.value});u.value.resetForm(),R.fire({icon:"success",title:`${l.data.message}`,text:`感謝您的訂購，訂單號碼： ${l.data.orderId}`,confirmButtonColor:"#3D081B"})}catch(l){R.fire({icon:"error",title:"錯誤",text:`${l.response.data.message}`,confirmButtonColor:"#3D081B"})}finally{d.value=!1,_.getCart()}};return(b,t)=>{const l=y("VLoading"),r=y("VField"),s=y("ErrorMessage"),f=y("VForm");return m(),p("div",xe,[a(l,{active:d.value,"is-full-page":!1},null,8,["active"]),a(f,{onSubmit:v,autocomplete:"off",ref_key:"formRef",ref:u},{default:E(({errors:V})=>[e("div",ke,[e("div",Ce,[e("div",we,[t[11]||(t[11]=e("h3",{class:"mb-8 fw-bold"},"顧客資訊",-1)),e("div",Fe,[e("div",Ee,[e("div",Se,[a(r,{type:"email",name:"Email",id:"email",class:$(["form-control border-custom",{"is-invalid":V.Email}]),placeholder:"請輸入 Email",rules:"required|email",modelValue:o.value.user.email,"onUpdate:modelValue":t[0]||(t[0]=i=>o.value.user.email=i)},null,8,["class","modelValue"]),t[7]||(t[7]=e("label",{for:"email"},"Email",-1)),a(s,{name:"Email",class:"invalid-feedback"})])]),e("div",Le,[e("div",Ue,[a(r,{type:"text",name:"姓名",id:"name",class:$(["form-control border-custom",{"is-invalid":V.姓名}]),rules:"required",placeholder:"請輸入 姓名",modelValue:o.value.user.name,"onUpdate:modelValue":t[1]||(t[1]=i=>o.value.user.name=i)},null,8,["class","modelValue"]),t[8]||(t[8]=e("label",{for:"姓名"},"姓名",-1)),a(s,{name:"姓名",class:"invalid-feedback"})])]),e("div",qe,[e("div",Re,[a(r,{type:"tel",name:"電話",id:"tel",class:$(["form-control border-custom",{"is-invalid":V.電話}]),rules:c,placeholder:"請輸入 電話",modelValue:o.value.user.tel,"onUpdate:modelValue":t[2]||(t[2]=i=>o.value.user.tel=i)},null,8,["class","modelValue"]),t[9]||(t[9]=e("label",{for:"tel"},"電話",-1)),a(s,{name:"電話",class:"invalid-feedback"})])]),e("div",Te,[e("div",Be,[a(r,{as:"textarea",name:"userForm.message",id:"message",cols:"30",rows:"10",class:"form-control border-custom",modelValue:o.value.message,"onUpdate:modelValue":t[3]||(t[3]=i=>o.value.message=i),placeholder:"請輸入留言"},null,8,["modelValue"]),t[10]||(t[10]=e("label",{for:"message"},"備註",-1))])])])]),e("div",De,[t[15]||(t[15]=e("h3",{class:"mb-8 fw-bold"},"用餐方式",-1)),e("div",Me,[e("div",Ne,[k(e("input",{class:"form-check-input",type:"radio",name:"type",id:"here",value:"內用",checked:"","onUpdate:modelValue":t[4]||(t[4]=i=>o.value.user.type=i)},null,512),[[q,o.value.user.type]]),t[12]||(t[12]=e("label",{class:"form-check-label",for:"here"},"內用",-1))]),e("div",je,[k(e("input",{class:"form-check-input",type:"radio",name:"type",id:"to_go",value:"外帶","onUpdate:modelValue":t[5]||(t[5]=i=>o.value.user.type=i)},null,512),[[q,o.value.user.type]]),t[13]||(t[13]=e("label",{class:"form-check-label",for:"to_go"},"外帶",-1))])]),o.value.user.type==="內用"?(m(),p("div",Oe,[e("div",Pe,[a(r,{type:"number",name:"座位號碼",id:"seat_number",class:$(["form-control border-custom",{"is-invalid":V.座位號碼}]),placeholder:"請輸入座位號碼",list:"list",modelValue:o.value.user.seat_number,"onUpdate:modelValue":t[6]||(t[6]=i=>o.value.user.seat_number=i),rules:"required"},null,8,["class","modelValue"]),t[14]||(t[14]=e("label",{for:"seat_number"},"座位號碼",-1)),a(s,{name:"座位號碼",class:"invalid-feedback"}),e("datalist",Ae,[(m(),p(w,null,B(10,i=>e("option",{key:i,value:i},null,8,ze)),64))])])])):S("",!0)])])]),t[16]||(t[16]=e("hr",null,null,-1)),a(Ve,{"user-form":o.value},null,8,["user-form"]),t[17]||(t[17]=e("div",{class:"text-center"},[e("button",{type:"submit",class:"btn btn-primary btn-lg"},"結帳")],-1))]),_:1},512)])}}},Ge=F(He,[["__scopeId","data-v-e4374be1"]]),Qe={class:"position-relative container py-8 min-vh-75"},Je={key:1,class:"text-center h-75"},We={__name:"CartView",setup(C){const o=x(),{cart:u}=T(o);return(c,d)=>{var _,v;return m(),p("div",Qe,[((_=n(u).carts)==null?void 0:_.length)>0?(m(),p(w,{key:0},[a(ce),a(Ge)],64)):n(u).carts&&((v=n(u).carts)==null?void 0:v.length)===0?(m(),p("div",Je,[d[1]||(d[1]=e("h2",{class:"mb-8 text-center"},"目前購物車為空 (´⊙ω⊙`)",-1)),a(n(H),{to:"/products",class:"btn btn-info px-5 py-3"},{default:E(()=>d[0]||(d[0]=[z("趕緊購物去")])),_:1})])):S("",!0)])}}};export{We as default};
