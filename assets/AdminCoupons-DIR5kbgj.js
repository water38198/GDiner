import{_ as T,r as c,w as E,e as M,f,g as x,j as d,k as L,h as e,t as w,n as $,m as S,q as U,E as R,l as A,z as B,A as F,o as P,F as Y,B as q,J as O,p as j,y as G,C as k,S as b,L as H}from"./index-De6SF3In.js";import{h as D}from"./moment-Cl4UOzQZ.js";import{P as J}from"./PaginationComp-BRDaDNfE.js";const y=v=>(B("data-v-001b0c48"),v=v(),F(),v),K={class:"bg-#212529 p-4 flex justify-between items-center"},Q={class:"text-white"},W={class:"grid grid-cols-2 gap-6 p-5"},X={class:"input-group"},Z=y(()=>e("label",{for:"name"},"名稱：",-1)),ee={class:"input-group"},te=y(()=>e("label",{for:"code"},"優惠碼：",-1)),oe={class:"input-group"},se=y(()=>e("label",{for:"due_date"},"到期日：",-1)),ae={class:"input-group mb-4"},le=y(()=>e("label",{for:"percent"},"優惠比例：",-1)),ne={for:"is_paid"},de={class:"text-end p-3 border-t border-solid border-#dee2e6"},ie=y(()=>e("button",{type:"submit",class:"m-1 px-3 py-1.5 text-white bg-#0d6efd border-0 rd hover:cursor-pointer hover:bg-#0b5ed7"},"確定",-1)),re={__name:"CouponModal",props:["tempCoupon","isNew"],setup(v,{expose:h}){const p=v,o=c(p.tempCoupon),u=c(),m=c("");function C(i){i.target.nodeName==="DIALOG"&&u.value.close()}return E(()=>p.tempCoupon,()=>{o.value={...p.tempCoupon},o.value.due_date&&(m.value=D(o.value.due_date).format("YYYY-MM-DD")),o.value.is_enabled||(o.value.is_enabled=0)}),E(()=>m.value,()=>{o.value.due_date=new Date(m.value).getTime()}),h({dialog:u}),(i,t)=>{const r=M("VField"),g=M("ErrorMessage"),V=M("VForm");return f(),x("dialog",{ref_key:"dialog",ref:u,class:"max-w-1140px w-100% border-0 rd p-0 backdrop:backdrop-blur-3",onClick:C},[d(V,{method:"dialog",onSubmit:t[7]||(t[7]=_=>i.$emit("confirmCoupon",o.value))},{default:L(({errors:_})=>[e("div",K,[e("h3",Q,w(v.isNew?"新增優惠券":"編輯優惠券"),1),e("button",{type:"button",class:"i-ic:baseline-close p-2 text-white font-size-4 hover:cursor-pointer",onClick:t[0]||(t[0]=l=>u.value.close())})]),e("div",W,[e("div",X,[Z,d(r,{type:"text",id:"name",name:"名稱",rules:"required",placeholder:"請輸入名稱",modelValue:o.value.title,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.title=l),class:$({invalid:_.名稱})},null,8,["modelValue","class"]),d(g,{name:"名稱",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",ee,[te,d(r,{type:"text",id:"code",name:"優惠碼",rules:"required",placeholder:"請輸入優惠碼",class:$({invalid:_.優惠碼}),modelValue:o.value.code,"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.code=l)},null,8,["class","modelValue"]),d(g,{name:"優惠碼",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",oe,[se,d(r,{type:"date",id:"due_date",name:"到期日",rules:"required",pattern:"yyyy-MM-dd",class:$({invalid:_.到期日}),modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=l=>m.value=l),min:S(D)().format("YYYY-MM-DD")},null,8,["class","modelValue","min"]),d(g,{name:"到期日",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",ae,[le,d(r,{type:"number",id:"percent",placeholder:"請輸入折扣百分比",name:"優惠比例",rules:"required||max_value:100||min_value:0",modelValue:o.value.percent,"onUpdate:modelValue":t[4]||(t[4]=l=>o.value.percent=l),modelModifiers:{number:!0},min:"0",class:$({invalid:_.優惠比例}),max:"100"},null,8,["modelValue","class"]),d(g,{name:"優惠比例",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",null,[e("label",ne,[U(e("input",{type:"checkbox",id:"is_paid","onUpdate:modelValue":t[5]||(t[5]=l=>o.value.is_enabled=l),class:"custom-checkbox","true-value":1,"false-value":0},null,512),[[R,o.value.is_enabled]]),A(" 是否啟用 ")])])]),e("div",de,[e("button",{type:"button",class:"m-1 px-3 py-1.5 bg-transparent text-#6c757d border-1 border-solid border-#6c757d rd hover:cursor-pointer hover:bg-#5c636a hover:text-white",onClick:t[6]||(t[6]=l=>u.value.close())},"取消"),ie])]),_:1})],512)}}},ue=T(re,[["__scopeId","data-v-001b0c48"]]);var ce={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const pe={class:"p-10 flex flex-col h-100%"},me=e("h2",{class:"font-size-12"},"優惠券",-1),ve={class:"relative min-h-100"},_e={class:"w-100% mt-6"},be=e("thead",{class:"border-b-1 border-black border-solid fw-bold text-left"},[e("tr",null,[e("th",{width:"120"}," 名稱 "),e("th",null,"優惠碼"),e("th",null," 到期日 "),e("th",null," 百分比 "),e("th",{width:"100",class:"text-center"}," 是否啟用 "),e("th",{width:"120"}," 編輯 ")])],-1),fe={class:"text-center"},he={key:0,class:"text-#198754"},ge={key:1,class:"text-red"},xe=["onClick"],Ce=["onClick"],we=G('<div><ul class="grid gap-2"><li>已過期 : <span class="text-red">紅色</span></li><li>三天之內 : <span class="text-orange">橘色</span></li><li>三到七天內 : <span class="text-yellow">黃色</span></li><li>七天以上 : <span class="text-green-700">綠色</span></li></ul></div>',1),Ve={__name:"AdminCoupons",setup(v){const{VITE_URL:h,VITE_PATH:p}=ce,o=c([]),u=c(!1),m=c({}),C=c({}),i=c(),t=c(!1);function r(s=1){u.value=!0,k.get(`${h}/v2/api/${p}/admin/coupons?page=${s}`).then(a=>{o.value=a.data.coupons,m.value=a.data.pagination}).catch(a=>{b.fire({icon:"error",title:"錯誤發生",text:a.response.data.message})}).finally(()=>{u.value=!1})}function g(){t.value=!0,C.value={},i.value.dialog.showModal()}function V(s){return D(s).format("YYYY-MM-DD")}function _(s){C.value=s,t.value=!1,i.value.dialog.showModal()}function l(s){t.value?k.post(`${h}/v2/api/${p}/admin/coupon`,{data:s}).then(a=>{b.fire({title:`${a.data.message}`,icon:"success",didClose:()=>{r()}}),i.value.dialog.close()}).catch(a=>{b.fire({title:"錯誤發生",text:`${a.response.data.message}`,icon:"error",target:"dialog"})}):k.put(`${h}/v2/api/${p}/admin/coupon/${s.id}`,{data:s}).then(a=>{b.fire({title:`${a.data.message}`,icon:"success",didClose:()=>{r()}}),i.value.dialog.close()}).catch(a=>{b.fire({title:"錯誤發生",text:`${a.response.data.message}`,icon:"error",target:"dialog"})})}function z(s){const{id:a}=s;k.delete(`${h}/v2/api/${p}/admin/coupon/${a}`).then(n=>{b.fire({title:`${n.data.message}`,icon:"success",didClose:()=>{r()}}),i.value.dialog.close()}).catch(n=>{b.fire({title:"錯誤發生",text:`${n.response.data.message}`,icon:"error",target:"dialog"})})}function I(s){return s-Date.now()<0?"text-red":s-Date.now()<3*24*60*60*1e3?"text-orange":s-Date.now()<7*24*60*60*1e3&&s-Date.now()>3*24*60*60*1e3?"text-yellow":"text-green-700"}return P(()=>{r()}),(s,a)=>(f(),x(Y,null,[e("div",pe,[me,e("div",ve,[d(S(H),{active:u.value,"is-full-page":!1},null,8,["active"]),e("div",{class:"text-end mt-6"},[e("button",{type:"button",class:"bg-#0d6efd border-0 text-white cursor-pointer inline-block px-3 py-1.5 rd font-size-4 hover:bg-#0b5ed7",onClick:g},"建立優惠券")]),e("table",_e,[be,e("tbody",null,[(f(!0),x(Y,null,q(o.value,n=>(f(),x("tr",{class:"border-b border-#DEE2E6 border-solid",key:n.id},[e("td",null,w(n.title),1),e("td",null,w(n.code),1),e("td",null,[e("span",{class:$(I(n.due_date))},w(V(n.due_date)),3)]),e("td",null,w(n.percent),1),e("td",fe,[n.is_enabled?(f(),x("span",he,"啟用")):(f(),x("span",ge,"未啟用"))]),e("td",null,[e("div",null,[e("button",{type:"button",class:"text-#0d6efd bg-transparent border-1 border-#0d6efd border-solid rd-tl rd-bl px-2 py-1 hover:bg-#0d6efd hover:text-white hover:cursor-pointer",onClick:N=>_(n)}," 編輯 ",8,xe),e("button",{type:"button",class:"text-#dc3545 bg-transparent border-1 border-#de3545 border-solid rd-tr rd-br px-2 py-1 hover:bg-#de3545 hover:text-white hover:cursor-pointer",onClick:N=>z(n)}," 刪除 ",8,Ce)])])]))),128))])])]),we,o.value.length?(f(),O(J,{key:0,pages:m.value,onChangePage:r,class:"mt-auto"},null,8,["pages"])):j("",!0)]),d(ue,{"temp-coupon":C.value,ref_key:"couponModalRef",ref:i,"is-new":t.value,onConfirmCoupon:l},null,8,["temp-coupon","is-new"])],64))}};export{Ve as default};
