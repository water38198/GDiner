import{y as z,r as b,x as G,o as m,c as p,a as e,t as g,b as s,w as B,n as f,q as O,F as T,g as q,k as S,v as H,G as j,H as J,u as F,h as E,S as h,M as K,C as Y,f as M,_ as Q,e as W}from"./index-ckO0Meki.js";import{_ as X}from"./PaginationComponent-1lhJg29O.js";import{u as Z}from"./index-DA4BbhiV.js";const ee={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},le={class:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"},te={class:"modal-content"},ae={class:"modal-header"},se={class:"modal-title fs-2",id:"ProductModalLabel"},oe={class:"modal-body"},ie={class:"container-fluid"},ne={class:"row"},de={class:"col-12 col-md-4"},re=["src"],ue={action:"/api/thisismycourse2/admin/upload",enctype:"multipart/form-data",method:"post",class:"my-4"},ce={class:"d-flex align-items-center mb-2"},me=["for"],pe=["onClick"],ve=["onUpdate:modelValue"],fe=["src"],be={action:"/api/thisismycourse2/admin/upload",enctype:"multipart/form-data",method:"post"},ge={class:"col-12 col-md-8"},_e={class:"row gy-4"},ye={class:"col-12"},Ve={class:"col-6"},he={class:"col-6"},$e={class:"col-6"},Ue={class:"col-6"},ke={class:"col-6"},xe={class:"col-12"},we={key:0,class:"list-unstyled d-flex"},Ce=["onClick"],Pe={class:"input-group"},De={class:"col-12"},Me={class:"col-12"},Te={class:"col-12"},Ee={class:"form-check"},Ne={class:"modal-footer"},Ie=["disabled"],Le={__name:"ProductModal",props:{product:{type:Object,default:()=>({})},isNew:{type:Boolean,default:!1}},emits:["refresh"],setup(A,{emit:C}){const{VITE_URL:$,VITE_PATH:U}=ee,c=A,x=C,w=z(()=>c.isNew?"新增商品":"編輯商品"),t=b({...c.product});G(()=>c.product,r=>{t.value={...r}});const _=b(null),N=async()=>{const r=c.isNew?"post":"put",l=c.isNew?`${$}/v2/api/${U}/admin/product`:`${$}/v2/api/${U}/admin/product/${t.value.id}`;(c.isNew||!t.value.created)&&(t.value.created=Date.now());try{o.value=!0;const i=await E[r](l,{data:t.value});h.fire({icon:"success",title:`${i.data.message}`,showConfirmButton:!1,timer:1500,didClose:()=>{o.value=!1,x("refresh"),K.getInstance(_.value).hide()}})}catch(i){h.fire({icon:"error",title:"錯誤",text:`${i.response.data.message||"請稍後再試"}`})}},P=()=>{t.value.imagesUrl||(t.value.imagesUrl=[]);const r=t.value.imagesUrl.length;t.value.imagesUrl[r-1]!==""&&t.value.imagesUrl.push("")},D=async(r,l)=>{const i=l.target.files[0],u=new FormData;u.append("file-to-upload",i);try{const k=await E.post(`${$}/v2/api/${U}/admin/upload`,u);P(),r==="image"&&(t.value.imageUrl=k.data.imageUrl),r==="images"&&(t.value.imagesUrl[t.value.imagesUrl.length-1]=k.data.imageUrl),l.target.value=""}catch(k){h.fire({icon:"error",title:"上傳失敗",text:`${k.response.data.message||"請稍後再試"}`})}},I=r=>{t.value.imagesUrl.splice(r,1)},d=b(""),n=()=>{t.value.tags||(t.value.tags=[]),d.value.trim()!==""&&(t.value.tags.push(d.value),d.value="")},y=r=>{t.value.tags=t.value.tags.filter(l=>l!==r)},o=b(!1),{isDemo:L}=Y("demo");return(r,l)=>{const i=M("VField"),u=M("ErrorMessage"),k=M("VForm");return m(),p("div",{class:"modal fade",id:"ProductModal",tabindex:"-1","aria-labelledby":"ProductLabel","aria-hidden":"true",ref_key:"modalRef",ref:_},[e("div",le,[e("div",te,[e("div",ae,[e("h1",se,g(w.value),1),l[13]||(l[13]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",oe,[s(k,{onSubmit:N,id:"ProductForm"},{default:B(({errors:v})=>[e("div",ie,[e("div",ne,[e("div",de,[l[17]||(l[17]=e("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1)),s(i,{name:"主要圖片",id:"imageUrl",type:"text",placeholder:"請輸入圖片連結",modelValue:t.value.imageUrl,"onUpdate:modelValue":l[0]||(l[0]=a=>t.value.imageUrl=a),class:f(["form-control mb-2",{"is-invalid":v.主要圖片}]),rules:"required"},null,8,["modelValue","class"]),s(u,{name:"主要圖片",class:"invalid-feedback"}),t.value.imageUrl?(m(),p("img",{key:0,src:t.value.imageUrl,alt:"產品主要照片"},null,8,re)):O("",!0),e("form",ue,[e("input",{type:"file",name:"file-to-upload",onChange:l[1]||(l[1]=a=>D("image",a)),class:"form-control"},null,32)]),e("div",null,[l[15]||(l[15]=e("h4",{class:"mb-4 fs-6"},"多圖新增",-1)),(m(!0),p(T,null,q(t.value.imagesUrl,(a,V)=>(m(),p("div",{key:a,class:"mb-4"},[e("div",ce,[e("label",{for:`image-${V}`,class:"form-label"},"圖片網址"+g(V+1),9,me),e("button",{type:"button",class:"ms-auto fs-5",onClick:R=>I(V)},l[14]||(l[14]=[e("i",{class:"bi bi-x"},null,-1)]),8,pe)]),e("div",null,[S(e("input",{type:"text","onUpdate:modelValue":R=>t.value.imagesUrl[V]=R,placeholder:"請輸入圖片網址",class:"form-control"},null,8,ve),[[H,t.value.imagesUrl[V]]])]),e("img",{src:a,alt:"產品照片"},null,8,fe)]))),128)),e("div",{class:"mb-4"},[e("button",{type:"button",onClick:P,class:"btn btn-outline-primary"},"新增圖片")]),l[16]||(l[16]=e("hr",null,null,-1)),e("form",be,[e("input",{type:"file",name:"file-to-upload",onChange:l[2]||(l[2]=a=>D("images",a)),class:"form-control"},null,32)])])]),e("div",ge,[e("div",_e,[e("div",ye,[l[18]||(l[18]=e("label",{for:"title",class:"form-label"},"名稱：",-1)),s(i,{type:"text",id:"title",name:"名稱",rules:"required",placeholder:"請輸入標題",modelValue:t.value.title,"onUpdate:modelValue":l[3]||(l[3]=a=>t.value.title=a),class:f(["form-control",{"is-invalid":v.名稱}])},null,8,["modelValue","class"]),s(u,{name:"名稱",class:"invalid-feedback"})]),e("div",Ve,[l[20]||(l[20]=e("label",{for:"category",class:"form-label"},"分類：",-1)),s(i,{as:"select",name:"分類",rules:"required",id:"category",class:f(["form-select",{"is-invalid":v.分類}]),modelValue:t.value.category,"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.category=a)},{default:B(()=>l[19]||(l[19]=[e("option",{value:"主食"},"主食",-1),e("option",{value:"沙拉"},"沙拉",-1),e("option",{value:"湯品"},"湯品",-1),e("option",{value:"副食"},"副食",-1),e("option",{value:"甜點"},"甜點",-1),e("option",{value:"飲料"},"飲料",-1),e("option",{value:"套餐"},"套餐",-1)])),_:2},1032,["class","modelValue"]),s(u,{name:"分類",class:"invalid-feedback"})]),e("div",he,[l[21]||(l[21]=e("label",{for:"unit",class:"form-label"},"單位：",-1)),s(i,{type:"text",id:"unit",placeholder:"請輸入單位",modelValue:t.value.unit,"onUpdate:modelValue":l[5]||(l[5]=a=>t.value.unit=a),list:"units",name:"單位",rules:"required",class:f(["form-control",{"is-invalid":v.單位}]),autocomplete:"off"},null,8,["modelValue","class"]),l[22]||(l[22]=e("datalist",{id:"units"},[e("option",{value:"碗"}),e("option",{value:"客"}),e("option",{value:"杯"}),e("option",{value:"份"}),e("option",{value:"個"})],-1)),s(u,{name:"單位",class:"invalid-feedback"})]),e("div",$e,[l[23]||(l[23]=e("label",{for:"origin_price",class:"form-label"},"原價：",-1)),s(i,{type:"number",name:"原價",id:"origin_price",placeholder:"請輸入原價",min:"0",rules:"required|min_value:0",class:f(["form-control",{"is-invalid":v.原價}]),modelValue:t.value.origin_price,"onUpdate:modelValue":l[6]||(l[6]=a=>t.value.origin_price=a),modelModifiers:{number:!0}},null,8,["class","modelValue"]),s(u,{name:"原價",class:"invalid-feedback"})]),e("div",Ue,[l[24]||(l[24]=e("label",{for:"price",class:"form-label"},"售價：",-1)),s(i,{type:"number",id:"price",placeholder:"請輸入售價",min:"0",modelValue:t.value.price,"onUpdate:modelValue":l[7]||(l[7]=a=>t.value.price=a),modelModifiers:{number:!0},name:"售價",rules:{required:!0,max_value:t.value.origin_price,min_value:0},class:f(["form-control",{"is-invalid":v.售價}])},null,8,["modelValue","rules","class"]),s(u,{name:"售價",class:"invalid-feedback"})]),e("div",ke,[l[26]||(l[26]=e("label",{for:"veggie",class:"form-label"},"素食:",-1)),s(i,{as:"select",id:"veggie",modelValue:t.value.veggie,"onUpdate:modelValue":l[8]||(l[8]=a=>t.value.veggie=a),name:"素食",rules:"required",class:f(["form-select",{"is-invalid":v.素食}])},{default:B(()=>l[25]||(l[25]=[e("option",{value:"全素",class:"text-success"},"全素",-1),e("option",{value:"蛋奶素",class:"text-warning"},"蛋奶素",-1),e("option",{value:"葷食",class:"text-danger"},"葷食",-1)])),_:2},1032,["modelValue","class"]),s(u,{name:"素食",class:"invalid-feedback"})]),e("div",xe,[l[27]||(l[27]=e("label",{for:"tags",class:"form-label"},"標籤：",-1)),t.value.tags?(m(),p("ul",we,[(m(!0),p(T,null,q(t.value.tags,(a,V)=>(m(),p("li",{key:`${V}+${a}`},[e("button",{class:"btn btn-outline-primary",onClick:R=>y(a)},g(a),9,Ce)]))),128))])):O("",!0),e("div",Pe,[S(e("input",{type:"text",id:"tags","onUpdate:modelValue":l[9]||(l[9]=a=>d.value=a),onKeydown:j(n,["enter"]),class:"form-control"},null,544),[[H,d.value,void 0,{trim:!0}]]),e("button",{type:"button",class:"btn btn-outline-primary",onClick:n},"新增標籤")])]),e("div",De,[l[28]||(l[28]=e("label",{for:"description",class:"form-label"},"商品敘述:",-1)),s(i,{as:"textarea",id:"description",rows:"6",modelValue:t.value.description,"onUpdate:modelValue":l[10]||(l[10]=a=>t.value.description=a),name:"產品敘述",rules:"required",class:f(["form-control",{"is-invalid":v.產品敘述}]),placeholder:"例如：這是法國進口超好吃的馬卡龍，加上阿橘大廚特製的冰淇淋"},null,8,["modelValue","class"]),s(u,{name:"產品敘述",class:"invalid-feedback"})]),e("div",Me,[l[29]||(l[29]=e("label",{for:"content",class:"form-label"},"商品內容:",-1)),s(i,{as:"textarea",id:"content",rows:"4",class:f(["form-control",{"is-invalid":v.商品內容}]),modelValue:t.value.content,"onUpdate:modelValue":l[11]||(l[11]=a=>t.value.content=a),name:"商品內容",rules:"required",placeholder:"例如：牛排 * 1 客"},null,8,["modelValue","class"]),s(u,{name:"商品內容",class:"invalid-feedback"})]),e("div",Te,[e("div",Ee,[S(e("input",{class:"form-check-input",type:"checkbox",id:"is_enabled","onUpdate:modelValue":l[12]||(l[12]=a=>t.value.is_enabled=a),"true-value":1,"false-value":0},null,512),[[J,t.value.is_enabled]]),l[30]||(l[30]=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1))])])])])])])]),_:1})]),e("div",Ne,[l[31]||(l[31]=e("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"},"取消",-1)),e("button",{type:"submit",form:"ProductForm",class:"btn btn-primary",disabled:o.value||F(L)},"確認",8,Ie)])])])],512)}}},Re={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},Be={class:"position-relative container py-10"},Se={class:"table-responsive"},qe={class:"table align-middle"},Fe={class:"table-group-divider"},Ae=["src","alt"],Oe={key:0,class:"text-success"},He={key:1,class:"text-danger"},Ye={class:"text-end"},ze={class:"btn-group",role:"group","aria-label":"edit button group"},Ge=["onClick"],je=["onClick","disabled"],Je={__name:"AdminProducts",setup(A){const{VITE_URL:C,VITE_PATH:$}=Re,U=b([]),c=b(!1),x=b({}),w=b(!1),t=b({}),_=async(d=1)=>{try{c.value=!0;const n=await E.get(`${C}/v2/api/${$}/admin/products?page=${d}`);U.value=n.data.products,t.value=n.data.pagination}catch(n){h.fire({icon:"error",title:"錯誤",text:`${n.response.data.message||"請稍後再試"}`})}finally{c.value=!1}};W(()=>{_()});const N=()=>{x.value={},w.value=!0},P=d=>{x.value=JSON.parse(JSON.stringify(d)),w.value=!1},D=d=>{h.fire({title:`確定要刪除${d.title}嗎？`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",confirmButtonColor:"#d33",cancelButtonText:"取消"}).then(async n=>{if(n.isConfirmed)try{c.value=!0;const y=await E.delete(`${C}/v2/api/${$}/admin/product/${d.id}`);h.fire({title:y.data.message,icon:"success",showConfirmButton:!1,toast:!0,timer:1500,position:"top"})}catch(y){h.fire({icon:"error",title:"錯誤",text:`${y.response.data.message||"請稍後再試"}`})}finally{c.value=!1,_()}})},{isDemo:I}=Y("demo");return(d,n)=>{const y=M("VLoading");return m(),p(T,null,[e("div",Be,[s(y,{active:c.value,"is-full-page":!1},null,8,["active"]),n[1]||(n[1]=e("h2",{class:"text-center fw-bold"},"商品管理",-1)),e("div",{class:"mb-8 text-end"},[e("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#ProductModal",onClick:N},"建立商品")]),e("div",Se,[e("table",qe,[n[0]||(n[0]=e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"上架日期"),e("th",null,"分類"),e("th",null,"名稱"),e("th",null,"原價"),e("th",null,"售價"),e("th",null,"啟用"),e("th",{class:"text-end"},"編輯")])],-1)),e("tbody",Fe,[(m(!0),p(T,null,q(U.value,o=>(m(),p("tr",{key:o.id},[e("td",null,[e("img",{src:o.imageUrl,alt:`${o.title}的圖片`},null,8,Ae)]),e("td",null,g(F(Z)(o.created,"YYYY-MM-DD")),1),e("td",null,g(o.category),1),e("td",null,g(o.title),1),e("td",null,g(o.origin_price),1),e("td",null,g(o.price),1),e("td",null,[o.is_enabled?(m(),p("span",Oe,"啟用")):(m(),p("span",He,"未啟用"))]),e("td",Ye,[e("div",ze,[e("button",{type:"button",class:"btn btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#ProductModal",onClick:L=>P(o)},"編輯",8,Ge),e("button",{type:"button",class:"btn btn-outline-danger",onClick:L=>D(o),disabled:F(I)}," 刪除 ",8,je)])])]))),128))])])]),s(X,{pagination:t.value,onChangePage:_},null,8,["pagination"])]),s(Le,{product:x.value,isNew:w.value,onRefresh:_},null,8,["product","isNew"])],64)}}},Xe=Q(Je,[["__scopeId","data-v-de9353ae"]]);export{Xe as default};
