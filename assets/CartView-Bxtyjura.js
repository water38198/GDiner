import{a as L,_ as b,u as C,o as d,c as u,b as t,F,j as R,d as a,w as v,e as V,t as p,r as l,p as w,i as I,f as S,v as U,g as E,n as f,R as P,m as q}from"./index-Cd9JHZzw.js";const A={props:{cart:{type:Object,required:!0}},methods:{...L(C,["updateCart","deleteCart"])}},g=e=>(w("data-v-d24d64fb"),e=e(),I(),e),D={class:"table-responsive"},N={class:"table"},B=g(()=>t("thead",null,[t("tr",null,[t("th",{class:"text-left th-product",scope:"col"},"料理"),t("th",{scope:"col"},"數量"),t("th",{scope:"col",class:"text-end"},"小計"),t("th",{scope:"col"},"刪除")])],-1)),O={class:"table-group-divider"},M={class:"d-flex gap-4"},j=["src","alt"],H={class:"opacity-75 fs-5 mb-3"},G={class:"opacity-50"},z={class:"d-flex justify-content-between custom-border quantity-input"},J=["onClick"],K=g(()=>t("i",{class:"bi bi-dash fs-4"},null,-1)),Q=[K],W=["value","onChange"],X=["onClick"],Y=g(()=>t("i",{class:"bi bi-plus fs-4"},null,-1)),Z=[Y],tt={class:"text-end"},et={class:"text-end"},st=["onClick"],ot=g(()=>t("i",{class:"bi bi-trash fs-4"},null,-1)),at=[ot];function nt(e,o,r,$,n,m){const _=l("RouterLink");return d(),u("div",D,[t("table",N,[B,t("tbody",O,[(d(!0),u(F,null,R(r.cart.carts,s=>(d(),u("tr",{key:s.id},[t("td",null,[t("div",M,[t("img",{src:s.product.imageUrl,alt:`${s.product.title}的照片`,class:"product-image border border-primary rounded-3"},null,8,j),t("div",null,[t("div",H,[a(_,{to:`/product/${s.product.id}`},{default:v(()=>[V(p(s.product.title),1)]),_:2},1032,["to"])]),t("p",G,"NT$"+p(s.product.price),1)])])]),t("td",null,[t("div",z,[t("button",{type:"button",class:"d-block px-4 bg-transparent border-0",onClick:i=>{s.qty-1>0&&s.qty--,e.updateCart(s)}},Q,8,J),t("input",{type:"number",id:"quantity",value:s.qty,class:"d-block bg-transparent border-0 appearance-none outline-0 text-center",min:"1",onChange:i=>e.updateCart(s,i)},null,40,W),t("button",{type:"button",class:"d-block px-4 bg-transparent border-0",onClick:i=>{s.qty++,e.updateCart(s)}},Z,8,X)])]),t("td",tt,[t("span",null,"NT$ "+p(Math.floor(s.final_total)),1)]),t("td",et,[t("button",{type:"button",onClick:i=>e.deleteCart(s.id)},at,8,st)])]))),128))])])])}const rt=b(A,[["render",nt],["__scopeId","data-v-d24d64fb"]]);var lt={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:it,VITE_PATH:ct}=lt,dt={props:{cart:{type:Object,required:!0}},data(){return{coupon:""}},methods:{async useCoupon(){if(this.coupon)try{const e=await this.$http.post(`${it}/v2/api/${ct}/coupon`,{data:{code:this.coupon}});this.$swal({icon:"success",title:`${e.data.message}`,toast:!0,position:"bottom-end",timer:1500,showConfirmButton:!1}),this.coupon="",this.getCart()}catch(e){this.$swal({icon:"error",title:`${e.response.data.message}`})}}}},ut={class:"d-sm-flex border-2 border-primary border-bottom py-4 mb-4"},mt={class:"ms-auto"},_t={class:"input-group mb-4"},pt={class:"form-floating"},ht=t("label",{for:"coupon"},"優惠券",-1),ft={key:0,class:"mb-4 text-end"},bt={class:"mb-2"},vt={class:"d-flex justify-content-end align-items-center"},gt=t("h3",{class:"me-5 mb-0"},"總計",-1),$t={key:0,class:"text-primary fs-5 mb-0"},yt={key:1,class:"text-red-500 fs-5 mb-0"};function Ct(e,o,r,$,n,m){const _=l("RouterLink");return d(),u("div",ut,[a(_,{to:"/products",class:"d-block text-decoration-underline text-offset-4 text-center me-4 mb-10"},{default:v(()=>[V(" 繼續購物 ")]),_:1}),t("div",mt,[t("div",null,[t("div",_t,[t("div",pt,[S(t("input",{type:"text",name:"coupon",id:"coupon",class:"bg-secondary form-control border border-2 border-primary",placeholder:"請輸入 優惠券","onUpdate:modelValue":o[0]||(o[0]=s=>n.coupon=s)},null,512),[[U,n.coupon,void 0,{trim:!0}]]),ht]),t("button",{type:"button",class:"btn border-2 btn-outline-primary",onClick:o[1]||(o[1]=(...s)=>m.useCoupon&&m.useCoupon(...s))},"使用")]),r.cart.carts[0].coupon?(d(),u("div",ft,[t("p",bt,"已套用優惠券代碼："+p(r.cart.carts[0].coupon.code),1),t("p",null,"折扣金額： -"+p(Math.floor(r.cart.total-r.cart.final_total)),1)])):E("",!0)]),t("div",null,[t("div",vt,[gt,r.cart.total==r.cart.final_total?(d(),u("p",$t,"NT$ "+p(r.cart.total),1)):(d(),u("p",yt,"NT$"+p(Math.floor(r.cart.final_total)),1))])])])])}const Vt=b(dt,[["render",Ct]]);var xt={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:kt,VITE_PATH:Lt}=xt,Et={props:{cart:{type:Object}},emits:["getCart"],data(){return{isLoading:!1,userForm:{user:{email:"",name:"",tel:"",address:""},message:""}}},methods:{async submitOrder(){if(this.cart.carts.length===0){this.$swal({icon:"error",title:"目前沒有東西在購物車喔~"});return}try{this.isLoading=!0;const e=await this.$http.post(`${kt}/v2/api/${Lt}/order`,{data:this.userForm});this.$swal({title:e.data.message,icon:"success",timer:2e3,showConfirmButton:!1}).then(()=>{this.$emit("getCart"),this.$router.push(`order?id=${e.data.orderId}`)})}catch(e){this.$swal({title:"錯誤發生",icon:"error",text:`${e.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`,confirmButtonColor:"#3D081B"})}finally{this.isLoading=!1}},isPhone(e){return/^(09)[0-9]{8}$/.test(e)?!0:"請輸入正確的電話號碼"}}},Tt={class:"py-10 px-4"},Ft={class:"row gy-4 gy-md-6"},Rt=t("h2",{class:"text-center"},"顧客資訊",-1),wt={class:"form-floating"},It=t("label",{for:"email"},"Email",-1),St={class:"col-sm-6"},Ut={class:"form-floating"},Pt=t("label",{for:"姓名"},"姓名",-1),qt={class:"col-sm-6"},At={class:"form-floating"},Dt=t("label",{for:"電話"},"電話",-1),Nt={class:"form-floating"},Bt=t("label",{for:"地址"},"地址",-1),Ot={class:"form-floating"},Mt=t("label",{for:"message"},"留言(非必須)",-1),jt=t("div",{class:"text-center pt-6"},[t("button",{type:"submit",class:"btn btn-info px-4 py-2"},"送出訂單")],-1);function Ht(e,o,r,$,n,m){const _=l("VLoading"),s=l("VField"),i=l("ErrorMessage"),y=l("VForm");return d(),u("div",Tt,[a(_,{active:n.isLoading},null,8,["active"]),a(y,{class:"w-md-50 mx-auto",onSubmit:m.submitOrder,autocomplete:"off",ref:"CartForm"},{default:v(({errors:h})=>[t("div",Ft,[Rt,t("div",null,[t("div",wt,[a(s,{type:"email",name:"Email",id:"email",class:f(["form-control custom-border",{"is-invalid":h.Email}]),placeholder:"請輸入 Email",rules:"required|email",modelValue:n.userForm.user.email,"onUpdate:modelValue":o[0]||(o[0]=c=>n.userForm.user.email=c)},null,8,["class","modelValue"]),It,a(i,{name:"Email",class:"text-danger ms-3"})])]),t("div",St,[t("div",Ut,[a(s,{type:"text",name:"姓名",id:"name",class:f(["form-control custom-border",{"is-invalid":h.姓名}]),rules:"required",placeholder:"請輸入 姓名",modelValue:n.userForm.user.name,"onUpdate:modelValue":o[1]||(o[1]=c=>n.userForm.user.name=c)},null,8,["class","modelValue"]),Pt,a(i,{name:"姓名",class:"text-danger ms-3"})])]),t("div",qt,[t("div",At,[a(s,{type:"tel",name:"電話",id:"tel",class:f(["form-control custom-border",{"is-invalid":h.電話}]),rules:m.isPhone,placeholder:"請輸入 電話",modelValue:n.userForm.user.tel,"onUpdate:modelValue":o[2]||(o[2]=c=>n.userForm.user.tel=c)},null,8,["class","rules","modelValue"]),Dt,a(i,{name:"電話",class:"text-danger ms-3"})])]),t("div",null,[t("div",Nt,[a(s,{type:"address",name:"地址",id:"address",class:f(["form-control custom-border",{"is-invalid":h.地址}]),rules:"required",placeholder:"請輸入 地址",modelValue:n.userForm.user.address,"onUpdate:modelValue":o[3]||(o[3]=c=>n.userForm.user.address=c)},null,8,["class","modelValue"]),Bt,a(i,{name:"地址",class:"text-danger ms-3"})])]),t("div",null,[t("div",Ot,[a(s,{as:"textarea",name:"userForm.message",id:"message",cols:"30",rows:"10",class:"form-control custom-border",modelValue:n.userForm.message,"onUpdate:modelValue":o[4]||(o[4]=c=>n.userForm.message=c),placeholder:"請輸入留言"},null,8,["modelValue"]),Mt])]),jt])]),_:1},8,["onSubmit"])])}const Gt=b(Et,[["render",Ht]]),zt={components:{RandomProduct:P,CartTable:rt,CartCoupon:Vt,CartForm:Gt},computed:{...q(C,["cart","cartLoading"]),excludeList(){const e=[];return this.cart.carts&&this.cart.carts.forEach(o=>e.push(o.product.id)),e}},methods:{...L(C,["getCart","deleteCartAll"])}},Jt={class:"container px-2 md:px-12 py-5 py-md-10"},Kt={class:"mb-5 mb-md-10"},Qt={key:0,"data-aos":"fade-up"},Wt={class:"d-flex justify-content-between align-items-center pb-2 pb-md-8"},Xt=t("h2",{class:"fs-3 fs-md-1"},"購物車",-1),Yt={key:1,class:"text-center py-20"},Zt=t("h2",{class:"mb-7"}," 目前購物車為空 (´⊙ω⊙`) ",-1),te={class:"text-center"};function ee(e,o,r,$,n,m){var x,k;const _=l("VLoading"),s=l("CartTable"),i=l("CartCoupon"),y=l("CartForm"),h=l("RouterLink"),c=l("RandomProduct");return d(),u("div",Jt,[a(_,{active:e.cartLoading},null,8,["active"]),t("div",Kt,[((x=e.cart.carts)==null?void 0:x.length)>0?(d(),u("div",Qt,[t("div",Wt,[Xt,t("button",{type:"button",class:"bg-transparent border-0 text-decoration-underline text-offset-4",onClick:o[0]||(o[0]=(...T)=>e.deleteCartAll&&e.deleteCartAll(...T))},"清空購物車")]),a(s,{cart:e.cart},null,8,["cart"]),a(i,{cart:e.cart},null,8,["cart"]),a(y,{cart:e.cart,onGetCart:e.getCart},null,8,["cart","onGetCart"])])):e.cart.carts&&((k=e.cart.carts)==null?void 0:k.length)===0?(d(),u("div",Yt,[Zt,t("div",te,[a(h,{to:"/products",class:"btn btn-info px-5 py-3"},{default:v(()=>[V("趕緊購物去")]),_:1})])])):E("",!0)]),a(c,{exclude:m.excludeList},null,8,["exclude"])])}const oe=b(zt,[["render",ee]]);export{oe as default};
