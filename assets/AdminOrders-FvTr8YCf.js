import{a as M,S as y}from"./sweetalert2.all-BG_37rGc.js";import{h as I}from"./moment-Cl4UOzQZ.js";import{L as z}from"./index-CegEb7TS.js";import{r as v,c as T,w as U,e as a,f as d,g as e,p as f,v as $,t as c,i as E,F as k,z as C,B,l as N,n as L,x as P,y as R,o as A,j as S,m as q,I as J}from"./index-BGcmftwk.js";import{_ as Y}from"./plugin-vueexport-helper-DlAUqK2U.js";import{P as j}from"./PaginationComp-BHsoW4WD.js";const p=m=>(P("data-v-9efebd24"),m=m(),R(),m),F={method:"dialog"},G={class:"bg-#212529 flex justify-between items-center p-4"},H=p(()=>e("h3",{class:"text-white"},"修改訂單",-1)),K={class:"grid grid-cols-2 gap-6 p-3"},Q={key:0},W=p(()=>e("h4",{class:"text-center font-size-6 mb-2"},"客戶資料",-1)),X={class:"input-group"},Z=p(()=>e("label",{for:"name"},"姓名",-1)),ee={class:"input-group"},te=p(()=>e("label",{for:"tel"},"電話",-1)),oe={class:"input-group"},se=p(()=>e("label",{for:"email"},"Email",-1)),le={class:"input-group"},re=p(()=>e("label",{for:"address"},"地址",-1)),ne=p(()=>e("h4",null,"留言：",-1)),ae={class:"flex flex-col"},de=p(()=>e("h4",{class:"text-center font-size-6"},"購買的商品",-1)),ie=p(()=>e("thead",null,[e("tr",null,[e("th",{class:"font-size-5"},"商品名稱"),e("th",{class:"font-size-5"},"數量")])],-1)),ue={class:"text-center font-size-4.5"},ce={class:"input-group"},pe=["onUpdate:modelValue","onChange"],_e={class:"text-end col-start-2"},he={for:"is_paid",class:"me-2"},ve={class:"text-end p-3 border-t border-solid border-#dee2e6"},me={__name:"OrderModal",props:["tempOrder"],setup(m,{expose:b}){const _=m,t=v(_.tempOrder),h=v(),O=T(()=>JSON.stringify(_.tempOrder)==JSON.stringify(t.value));function g(r){r.target.nodeName==="DIALOG"&&h.value.close()}function x(r){t.value.products[r.id].final_total=t.value.products[r.id].qty*t.value.products[r.id].product.price,t.value.products[r.id].total=t.value.products[r.id].final_total}return U(()=>_.tempOrder,()=>{t.value=JSON.parse(JSON.stringify(_.tempOrder))}),b({dialog:h}),(r,s)=>(a(),d("dialog",{ref_key:"dialog",ref:h,class:"max-w-1140px w-100% border-0 rd p-0 backdrop:backdrop-blur-3",onClick:g},[e("form",F,[e("div",G,[H,e("button",{type:"button",class:"i-ic:baseline-close p-2 text-white font-size-4 hover:cursor-pointer",onClick:s[0]||(s[0]=o=>h.value.close())})]),e("div",K,[t.value.user?(a(),d("div",Q,[W,e("div",X,[Z,f(e("input",{type:"text",id:"name",placeholder:"請輸入標題","onUpdate:modelValue":s[1]||(s[1]=o=>t.value.user.name=o)},null,512),[[$,t.value.user.name]])]),e("div",ee,[te,f(e("input",{type:"tel",id:"tel",placeholder:"請輸入標題","onUpdate:modelValue":s[2]||(s[2]=o=>t.value.user.tel=o)},null,512),[[$,t.value.user.tel]])]),e("div",oe,[se,f(e("input",{type:"email",id:"email",placeholder:"請輸入標題","onUpdate:modelValue":s[3]||(s[3]=o=>t.value.user.email=o)},null,512),[[$,t.value.user.email]])]),e("div",le,[re,f(e("input",{type:"address",id:"address",placeholder:"請輸入標題","onUpdate:modelValue":s[4]||(s[4]=o=>t.value.user.address=o)},null,512),[[$,t.value.user.address]])]),e("div",null,[ne,e("p",null,c(t.value.message),1)])])):E("",!0),e("div",ae,[de,e("table",null,[ie,e("tbody",null,[(a(!0),d(k,null,C(t.value.products,o=>(a(),d("tr",{key:o.id},[e("td",ue,c(o.product.title),1),e("td",null,[e("div",ce,[f(e("input",{type:"number",min:"1","onUpdate:modelValue":w=>o.qty=w,onChange:w=>x(o)},null,40,pe),[[$,o.qty,void 0,{number:!0}]])])])]))),128))])])]),e("div",_e,[e("label",he,[f(e("input",{type:"checkbox",id:"is_paid","onUpdate:modelValue":s[5]||(s[5]=o=>t.value.is_paid=o),class:"custom-checkbox"},null,512),[[B,t.value.is_paid]]),N(" 是否付款 ")])])]),e("div",ve,[e("button",{type:"button",class:"m-1 px-3 py-1.5 bg-transparent text-#6c757d border-1 border-solid border-#6c757d rd hover:cursor-pointer hover:bg-#5c636a hover:text-white",onClick:s[6]||(s[6]=o=>h.value.close())},"取消"),e("button",{type:"button",class:L(["m-1 px-3 py-1.5 text-white bg-#0d6efd border-0 rd hover:cursor-pointer hover:bg-#0b5ed7",{disabled:O.value}]),onClick:s[7]||(s[7]=o=>r.$emit("confirmOrder",t.value))},"修改訂單",2)])])],512))}},fe=Y(me,[["__scopeId","data-v-9efebd24"]]);var be={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const ge={class:"p-10"},xe=e("h2",{class:"font-size-12"},"訂單",-1),ye={class:"relative min-h-100"},$e={class:"w-100% mt-6"},ke=e("thead",{class:"border-b-1 border-black border-solid fw-bold text-left"},[e("tr",null,[e("th",{width:"120"}," 下單時間 "),e("th",null,"ID"),e("th",null," 購買品項 "),e("th",null," 使用者資訊 "),e("th",null," 留言 "),e("th",{class:"text-center"}," 訂單總額 "),e("th",{width:"100",class:"text-center"}," 是否付款 "),e("th",{width:"120"}," 編輯 ")])],-1),Oe={class:"text-center"},we={class:"text-center"},Ce={key:0,class:"text-green"},Ve={key:1,class:"text-red"},Me={class:"btn-group"},Se=["onClick"],Ee=["onClick"],Ne={__name:"AdminOrders",setup(m){const{VITE_URL:b,VITE_PATH:_}=be,t=v([]),h=v({}),O=v({}),g=v(),x=v(!1);function r(i=1){x.value=!0,M.get(`${b}/v2/api/${_}/admin/orders?page=${i}`).then(u=>{t.value=u.data.orders,h.value=u.data.pagination}).catch(u=>{y.fire({icon:"error",title:"錯誤發生",text:u.response.data.message})}).finally(()=>{x.value=!1})}function s(i){O.value=i,g.value.dialog.showModal()}function o(i){y.fire({icon:"warning",title:"刪除訂單",text:`你確定要刪除 ${i} 這筆訂單嗎?`,showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確定"}).then(u=>{u.isConfirmed&&M.delete(`${b}/v2/api/${_}/admin/order/${i}`).then(l=>{y.fire({icon:"success",title:`${l.data.message}`,didClose:()=>{r()}})}).catch(()=>{y.fire("錯誤發生","","error")})})}function w(i){const u=i;let l=0;l=Object.keys(u.products).reduce((n,V)=>n+u.products[V].final_total,0),u.total=l,M.put(`${b}/v2/api/${_}/admin/order/${i.id}`,{data:u}).then(n=>{g.value.dialog.close(),y.fire({icon:"success",title:`${n.data.message}`,didClose:()=>{r()}})}).catch(n=>{console.log(n)})}function D(i){return I(i).format("YYYY-MM-DD")}return A(()=>{r()}),(i,u)=>(a(),d(k,null,[e("div",ge,[xe,e("div",ye,[S(q(z),{active:x.value,"is-full-page":!1},null,8,["active"]),e("table",$e,[ke,e("tbody",null,[(a(!0),d(k,null,C(t.value,l=>(a(),d("tr",{class:"border-b border-#DEE2E6 border-solid",key:l.id},[e("td",null,c(D(l.create_at*1e3)),1),e("td",null,c(l.id),1),e("td",null,[e("ul",null,[(a(!0),d(k,null,C(l.products,n=>(a(),d("li",{key:n.id},c(n.product.title)+" x "+c(n.qty),1))),128))])]),e("td",null,[e("ul",null,[(a(!0),d(k,null,C(l.user,(n,V)=>(a(),d("li",{key:n},c(V)+" : "+c(n),1))),128))])]),e("td",null,c(l.message),1),e("td",Oe,c(l.total),1),e("td",we,[l.is_paid?(a(),d("span",Ce,"已付款")):(a(),d("span",Ve,"尚未付款"))]),e("td",null,[e("div",Me,[e("button",{type:"button",class:"text-#0d6efd bg-transparent border-1 border-#0d6efd border-solid border-r-0 rd-tl rd-bl px-2 py-1 hover:bg-#0d6efd hover:text-white hover:cursor-pointer",onClick:n=>s(l)}," 編輯 ",8,Se),e("button",{type:"button",class:"text-#dc3545 bg-transparent border-1 border-#de3545 border-solid rd-tr rd-br px-2 py-1 hover:bg-#de3545 hover:text-white hover:cursor-pointer",onClick:n=>o(l.id)}," 刪除 ",8,Ee)])])]))),128))])])]),t.value.length?(a(),J(j,{key:0,pages:h.value,onChangePage:r},null,8,["pages"])):E("",!0)]),S(fe,{"temp-order":O.value,ref_key:"orderModalRef",ref:g,onConfirmOrder:w},null,8,["temp-order"])],64))}};export{Ne as default};
