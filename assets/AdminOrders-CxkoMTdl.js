import{h as M}from"./moment-Cl4UOzQZ.js";import{_ as C,o as n,c as i,d as a,e as $,b as e,n as g,t as c,i as V,F as b,l as x,g as k,v as E,q as z,f as P,r as f,p as D,k as S,s as L}from"./index-JINe9Ytb.js";import{P as N}from"./PaginationComponent-Bx7KWUck.js";const B={props:{tempOrder:{type:Object}},data(){return{modalOrder:{user:{}}}},computed:{isChanged(){return JSON.stringify(this.tempOrder)===JSON.stringify(this.modalOrder)}},methods:{showModal(){this.$refs.dialog.showModal()},close(){this.$refs.dialog.close()},autoClose(o){o.target.nodeName==="DIALOG"&&this.$refs.dialog.close()},changePrice(o){const{id:t}=o;this.modalOrder.products[t].final_total=this.modalOrder.products[t].qty*this.modalOrder.products[t].product.price,this.modalOrder.products[t].total=this.modalOrder.products[t].final_total},isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"請輸入正確的電話號碼"}},watch:{tempOrder(){this.modalOrder=JSON.parse(JSON.stringify(this.tempOrder))}}},p=o=>(D("data-v-da731965"),o=o(),S(),o),I={class:"bg-#212529 flex justify-between items-center p-4"},T=p(()=>e("h3",{class:"text-white"},"修改訂單",-1)),U={class:"grid grid-cols-2 gap-6 p-3"},q={key:0},R=p(()=>e("h4",{class:"text-center font-size-6 mb-2"},"客戶資料",-1)),F={class:"input-group"},A=p(()=>e("label",{for:"name"},"姓名",-1)),J={class:"input-group"},Y=p(()=>e("label",{for:"tel"},"電話",-1)),j={class:"input-group"},G=p(()=>e("label",{for:"email"},"Email",-1)),H={class:"input-group"},K=p(()=>e("label",{for:"address"},"地址",-1)),Q=p(()=>e("h4",null,"留言：",-1)),W={class:"flex flex-col"},X=p(()=>e("h4",{class:"text-center font-size-6"},"購買的商品",-1)),Z=p(()=>e("thead",null,[e("tr",null,[e("th",{class:"font-size-5"},"商品名稱"),e("th",{class:"font-size-5"},"數量")])],-1)),ee={class:"text-center font-size-4.5"},te={class:"input-group"},se=["onUpdate:modelValue","onChange"],oe={class:"text-end col-start-2"},re={for:"is_paid",class:"me-2 cursor-pointer"},le={class:"text-end p-3 border-t border-solid border-#dee2e6"};function de(o,t,u,m,r,d){const h=f("VField"),_=f("ErrorMessage"),v=f("VForm");return n(),i("dialog",{ref:"dialog",class:"max-w-1140px w-100% border-0 rd p-0 backdrop:backdrop-blur-3",onClick:t[8]||(t[8]=(...l)=>d.autoClose&&d.autoClose(...l))},[a(v,{method:"dialog",onSubmit:t[7]||(t[7]=l=>o.$emit("confirmOrder",r.modalOrder))},{default:$(({errors:l})=>[e("div",I,[T,e("button",{type:"button",class:"i-ic:baseline-close p-2 text-white font-size-4 hover:cursor-pointer",onClick:t[0]||(t[0]=(...s)=>d.close&&d.close(...s))})]),e("div",U,[u.tempOrder.user?(n(),i("div",q,[R,e("div",F,[A,a(h,{type:"text",id:"name",placeholder:"請輸入姓名",modelValue:r.modalOrder.user.name,"onUpdate:modelValue":t[1]||(t[1]=s=>r.modalOrder.user.name=s),modelModifiers:{trim:!0},name:"姓名",rules:"required",class:g({invalid:l.姓名})},null,8,["modelValue","class"]),a(_,{name:"姓名",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",J,[Y,a(h,{type:"tel",id:"tel",placeholder:"請輸入電話",modelValue:r.modalOrder.user.tel,"onUpdate:modelValue":t[2]||(t[2]=s=>r.modalOrder.user.tel=s),modelModifiers:{trim:!0},name:"電話",rules:d.isPhone,class:g({invalid:l.電話})},null,8,["modelValue","rules","class"]),a(_,{name:"電話",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",j,[G,a(h,{type:"email",id:"email",placeholder:"請輸入Email",modelValue:r.modalOrder.user.email,"onUpdate:modelValue":t[3]||(t[3]=s=>r.modalOrder.user.email=s),modelModifiers:{trim:!0},name:"Email",rules:"required|email",class:g({invalid:l.Email})},null,8,["modelValue","class"]),a(_,{name:"Email",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",H,[K,a(h,{type:"address",id:"address",placeholder:"請輸入地址",modelValue:r.modalOrder.user.address,"onUpdate:modelValue":t[4]||(t[4]=s=>r.modalOrder.user.address=s),modelModifiers:{trim:!0},name:"地址",rules:"required",class:g({invalid:l.地址})},null,8,["modelValue","class"]),a(_,{name:"地址",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",null,[Q,e("p",null,c(r.modalOrder.message),1)])])):V("",!0),e("div",W,[X,e("table",null,[Z,e("tbody",null,[(n(!0),i(b,null,x(r.modalOrder.products,s=>(n(),i("tr",{key:s.id},[e("td",ee,c(s.product.title),1),e("td",null,[e("div",te,[k(e("input",{type:"number",min:"1","onUpdate:modelValue":O=>s.qty=O,onChange:O=>d.changePrice(s)},null,40,se),[[E,s.qty,void 0,{number:!0}]])])])]))),128))])])]),e("div",oe,[e("label",re,[k(e("input",{type:"checkbox",id:"is_paid","onUpdate:modelValue":t[5]||(t[5]=s=>r.modalOrder.is_paid=s),class:"custom-checkbox cursor-pointer"},null,512),[[z,r.modalOrder.is_paid]]),P(" 是否付款 ")])])]),e("div",le,[e("button",{type:"button",class:"m-1 px-3 py-1.5 bg-transparent text-#6c757d border-1 border-solid border-#6c757d rd hover:cursor-pointer hover:bg-#5c636a hover:text-white",onClick:t[6]||(t[6]=(...s)=>d.close&&d.close(...s))},"取消"),e("button",{type:"submit",class:g(["m-1 px-3 py-1.5 text-white bg-#0d6efd border-0 rd cursor-pointer hover:bg-#0b5ed7",{disabled:d.isChanged}])},"修改訂單",2)])]),_:1})],512)}const ne=C(B,[["render",de],["__scopeId","data-v-da731965"]]);var ie={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:y,VITE_PATH:w}=ie,ae={components:{OrderModal:ne,PaginationComponent:N},data(){return{orders:[],pagination:{},tempOrder:{},isLoading:!1}},methods:{async getOrders(o=1){this.isLoading=!0;try{const t=await this.$http.get(`${y}/v2/api/${w}/admin/orders?page=${o}`);this.orders=t.data.orders,this.pagination=t.data.pagination}catch(t){this.$swal({icon:"error",title:"錯誤發生",text:t.response.data.message})}finally{this.isLoading=!1}},openOrderModal(o){this.tempOrder=o,this.$refs.orderModalRef.showModal()},deleteOrder(o){this.$swal({icon:"warning",title:"刪除訂單",text:`你確定要刪除 ${o} 這筆訂單嗎?`,showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確定"}).then(async t=>{if(t.isConfirmed)try{const u=await this.$http.delete(`${y}/v2/api/${w}/admin/order/${o}`);this.$swal({icon:"success",title:`${u.data.message}`,didClose:()=>{this.getOrders()}})}catch(u){this.$swal({icon:"error",title:"錯誤發生",text:u.response.data.message})}})},async confirmOrder(o){const t=o;let u=0;u=Object.keys(t.products).reduce((m,r)=>{const d=t.products[r].coupon?t.products[r].coupon.percent/100:1;return m+t.products[r].final_total*d},0),t.total=u;try{const m=await this.$http.put(`${y}/v2/api/${w}/admin/order/${o.id}`,{data:t});this.$refs.orderModalRef.close(),this.$swal({icon:"success",title:`${m.data.message}`,didClose:()=>{this.getOrders()}})}catch(m){this.$swal({title:"錯誤發生",icon:"error",text:`${m.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`,confirmButtonColor:"#3D081B"})}},getMoment(o){return M(o).format("YYYY-MM-DD")}},mounted(){this.getOrders()}},ce={class:"p-10"},ue=e("h2",{class:"font-size-12"},"訂單",-1),pe={class:"relative min-h-100"},me={class:"w-100% mt-6"},he=e("thead",{class:"border-b-1 border-black border-solid fw-bold text-left"},[e("tr",null,[e("th",{width:"120"},"下單時間"),e("th",null,"ID"),e("th",null,"購買品項"),e("th",null,"使用者資訊"),e("th",null,"留言"),e("th",{class:"text-center"},"訂單總額"),e("th",{width:"100",class:"text-center"},"是否付款"),e("th",{width:"120"},"編輯")])],-1),_e={class:"text-center"},fe={class:"text-center"},ge={key:0,class:"text-green"},be={key:1,class:"text-red"},Oe={class:"btn-group"},xe=["onClick"],ve=["onClick"];function ye(o,t,u,m,r,d){const h=f("VLoading"),_=f("PaginationComponent"),v=f("OrderModal");return n(),i(b,null,[e("div",ce,[ue,e("div",pe,[a(h,{active:r.isLoading,"is-full-page":!1},null,8,["active"]),e("table",me,[he,e("tbody",null,[(n(!0),i(b,null,x(r.orders,l=>(n(),i("tr",{class:"border-b border-#DEE2E6 border-solid",key:l.id},[e("td",null,c(d.getMoment(l.create_at*1e3)),1),e("td",null,c(l.id),1),e("td",null,[e("ul",null,[(n(!0),i(b,null,x(l.products,s=>(n(),i("li",{key:s.id},c(s.product.title)+" x "+c(s.qty),1))),128))])]),e("td",null,[e("ul",null,[(n(!0),i(b,null,x(l.user,(s,O)=>(n(),i("li",{key:s,class:"pt-2"},c(O)+" : "+c(s),1))),128))])]),e("td",null,c(l.message),1),e("td",_e,c(l.total),1),e("td",fe,[l.is_paid?(n(),i("span",ge,"已付款")):(n(),i("span",be,"尚未付款"))]),e("td",null,[e("div",Oe,[e("button",{type:"button",class:"text-#0d6efd bg-transparent border-1 border-#0d6efd border-solid border-r-0 rd-tl rd-bl px-2 py-1 hover:bg-#0d6efd hover:text-white hover:cursor-pointer",onClick:s=>d.openOrderModal(l)}," 編輯 ",8,xe),e("button",{type:"button",class:"text-#dc3545 bg-transparent border-1 border-#de3545 border-solid rd-tr rd-br px-2 py-1 hover:bg-#de3545 hover:text-white hover:cursor-pointer",onClick:s=>d.deleteOrder(l.id)}," 刪除 ",8,ve)])])]))),128))])])]),r.orders.length?(n(),L(_,{key:0,pages:r.pagination,onChangePage:d.getOrders},null,8,["pages","onChangePage"])):V("",!0)]),a(v,{"temp-order":r.tempOrder,ref:"orderModalRef",onConfirmOrder:d.confirmOrder},null,8,["temp-order","onConfirmOrder"])],64)}const Ve=C(ae,[["render",ye]]);export{Ve as default};
