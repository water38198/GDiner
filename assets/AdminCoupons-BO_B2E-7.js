import{h as f}from"./moment-Cl4UOzQZ.js";import{_ as M,M as T,o as c,c as m,b as e,t as h,d as i,w as $,n as C,f as D,s as k,r as p,F as v,j as L,q as E,g as Y,e as g}from"./index-BP2mD-gl.js";import{P}from"./PaginationComponent-CVF3ZIE_.js";var N={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:y,VITE_PATH:x}=N,R={props:{tempCoupon:{type:Object},isNew:{type:Boolean}},emits:["getCoupons"],data(){return{dateTime:"",modalCoupon:{},modal:null,isLoading:!1}},computed:{todayDate(){return f().format("YYYY-MM-DD")}},methods:{async confirmCoupon(){this.isLoading=!0;const n=this.isNew?"post":"put",t=this.isNew?`${y}/v2/api/${x}/admin/coupon`:`${y}/v2/api/${x}/admin/coupon/${this.modalCoupon.id}`;try{const d=await this.$http[n](t,{data:this.modalCoupon});this.$swal({title:`${d.data.message}`,icon:"success",didClose:()=>{this.modal.hide(),this.$emit("getCoupons")}})}catch(d){this.$swal({title:"錯誤發生",text:`${d.response.data.message}`,icon:"error"})}finally{this.isLoading=!1}}},watch:{tempCoupon(){this.modalCoupon={...this.tempCoupon},this.modalCoupon.due_date?this.dateTime=f(this.modalCoupon.due_date*1e3).format("YYYY-MM-DD"):this.dateTime=f(new Date().getTime()).format("YYYY-MM-DD"),this.modalCoupon.is_enabled||(this.modalCoupon.is_enabled=0)},dateTime(){this.modalCoupon.due_date=new Date(this.dateTime).getTime()/1e3}},mounted(){this.modal=new T("#CouponModal")}},U={class:"modal fade",id:"CouponModal",tabindex:"-1","aria-labelledby":"CouponLabel","aria-hidden":"true"},B={class:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"},I={class:"modal-content"},S={class:"modal-header"},A={class:"modal-title fs-2",id:"CouponModalLabel"},F=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},H={class:"row gy-6"},O={class:"col-md-6"},G=e("label",{for:"name",class:"form-label"},"名稱：",-1),z={class:"col-md-6"},j=e("label",{for:"code",class:"form-label"},"優惠碼：",-1),J={class:"col-md-6"},K=e("label",{for:"due_date",class:"form-label"},"到期日：",-1),Q={class:"col-md-6"},W=e("label",{for:"percent",class:"form-label"},"優惠比例：",-1),X={class:"form-check form-switch"},Z=e("label",{class:"form-check-label",for:"is_paid"},"是否啟用",-1),ee={class:"modal-footer"},te=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),oe=["disabled"];function se(n,t,d,_,o,a){const r=p("VField"),u=p("ErrorMessage"),b=p("VForm");return c(),m("div",U,[e("div",B,[e("div",I,[e("div",S,[e("h1",A,h(d.isNew?"新增優惠券":"編輯優惠券"),1),F]),e("div",q,[i(b,{onSubmit:a.confirmCoupon,id:"CouponForm"},{default:$(({errors:s})=>[e("div",H,[e("div",O,[e("div",null,[G,i(r,{type:"text",id:"name",name:"名稱",rules:"required",placeholder:"請輸入名稱",modelValue:o.modalCoupon.title,"onUpdate:modelValue":t[0]||(t[0]=l=>o.modalCoupon.title=l),modelModifiers:{trim:!0},class:C(["form-control",{"is-invalid":s.名稱}])},null,8,["modelValue","class"]),i(u,{name:"名稱",class:"invalid-feedback ps-3"})])]),e("div",z,[j,i(r,{type:"text",id:"code",name:"優惠碼",rules:"required",placeholder:"請輸入優惠碼",class:C(["form-control",{"is-invalid":s.優惠碼}]),modelValue:o.modalCoupon.code,"onUpdate:modelValue":t[1]||(t[1]=l=>o.modalCoupon.code=l),modelModifiers:{trim:!0}},null,8,["class","modelValue"]),i(u,{name:"優惠碼",class:"invalid-feedback ps-3"})]),e("div",J,[K,i(r,{type:"date",id:"due_date",name:"到期日",rules:"required",pattern:"yyyy-MM-dd",class:C(["form-control",{"is-invalid":s.到期日}]),modelValue:o.dateTime,"onUpdate:modelValue":t[2]||(t[2]=l=>o.dateTime=l),min:a.todayDate},null,8,["class","modelValue","min"]),i(u,{name:"到期日",class:"invalid-feedback ps-3"})]),e("div",Q,[W,i(r,{type:"number",id:"percent",placeholder:"請輸入折扣百分比",name:"優惠比例",rules:"required||max_value:100||min_value:0",modelValue:o.modalCoupon.percent,"onUpdate:modelValue":t[3]||(t[3]=l=>o.modalCoupon.percent=l),modelModifiers:{number:!0},min:"0",class:C(["form-control",{invalid:s.優惠比例}]),max:"100"},null,8,["modelValue","class"]),i(u,{name:"優惠比例",class:"invalid-feedback ps-3"})]),e("div",null,[e("div",X,[D(e("input",{class:"form-check-input",type:"checkbox",role:"switch","onUpdate:modelValue":t[4]||(t[4]=l=>o.modalCoupon.is_enabled=l),id:"is_paid","true-value":1,"false-value":0},null,512),[[k,o.modalCoupon.is_enabled]]),Z])])])]),_:1},8,["onSubmit"])]),e("div",ee,[te,e("button",{type:"submit",class:"btn btn-primary",form:"CouponForm",disabled:o.isLoading},"送出",8,oe)])])])])}const ne=M(R,[["render",se]]);var ae={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:w,VITE_PATH:V}=ae,le={components:{CouponModal:ne,PaginationComponent:P},data(){return{coupons:[],pagination:{},tempCoupon:{},isNew:!1,isLoading:!1}},methods:{async getCoupons(n=1){this.isLoading=!0;try{const t=await this.$http.get(`${w}/v2/api/${V}/admin/coupons?page=${n}`);this.coupons=t.data.coupons,this.pagination=t.data.pagination}catch(t){console.log(t),this.$swal({icon:"error",title:"錯誤發生",text:t.response.data.message})}finally{this.isLoading=!1}},getMoment(n){return f(n).format("YYYY-MM-DD")},addCoupon(){this.isNew=!0,this.tempCoupon={}},editCoupon(n){this.tempCoupon=n,this.isNew=!1},deleteCoupon(n){const{id:t}=n;this.$swal({title:`你確定要刪除優惠券${n.title}`,icon:"question",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確定"}).then(async d=>{if(d.isConfirmed)try{const _=await this.$http.delete(`${w}/v2/api/${V}/admin/coupon/${t}`);this.$swal({title:`${_.data.message}`,icon:"success",didClose:()=>{this.getCoupons()}})}catch(_){this.$swal({title:"錯誤發生",text:`${_.response.data.message}`,icon:"error",target:"dialog"})}})},dateColor(n){const t=Date.now()/1e3;return n-t<0?"text-danger":n-t<7*24*60*60?"text-warning":"text-success"}},mounted(){this.getCoupons()}},ie={class:"py-4 py-md-10"},de=e("h2",{class:"text-center fs-1"},"優惠券",-1),ce={class:"text-end mt-6"},re={class:"table-responsive"},ue={class:"table mt-6 text-nowrap align-middle"},me=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"優惠碼"),e("th",null,"到期日"),e("th",null,"百分比"),e("th",{class:"text-center"},"是否啟用"),e("th",{class:"text-center"},"編輯")])],-1),pe={class:"text-center"},_e={key:0,class:"text-success"},he={key:1,class:"text-danger"},Ce={class:"text-center"},fe={class:"btn-group text-nowrap"},be=["onClick"],ge=["onClick"],ve=e("ul",null,[e("li",null,[g("已過期 & 三天之內 : "),e("span",{class:"text-danger"},"紅色")]),e("li",null,[g("三到七天內 : "),e("span",{class:"text-warning"},"黃色")]),e("li",null,[g("七天以上 : "),e("span",{class:"text-success"},"綠色")])],-1);function ye(n,t,d,_,o,a){const r=p("VLoading"),u=p("PaginationComponent"),b=p("CouponModal");return c(),m(v,null,[i(r,{active:o.isLoading},null,8,["active"]),e("div",ie,[de,e("div",ce,[e("button",{type:"button",class:"btn btn-primary px-3 py-2",onClick:t[0]||(t[0]=(...s)=>a.addCoupon&&a.addCoupon(...s)),"data-bs-toggle":"modal","data-bs-target":"#CouponModal"},"建立優惠券")]),e("div",re,[e("table",ue,[me,e("tbody",null,[(c(!0),m(v,null,L(o.coupons,s=>(c(),m("tr",{key:s.id},[e("td",null,h(s.title),1),e("td",null,h(s.code),1),e("td",null,[e("span",{class:C(a.dateColor(s.due_date))},h(a.getMoment(s.due_date*1e3)),3)]),e("td",null,h(s.percent),1),e("td",pe,[s.is_enabled?(c(),m("span",_e,"啟用")):(c(),m("span",he,"未啟用"))]),e("td",Ce,[e("div",fe,[e("button",{type:"button",class:"btn btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#CouponModal",onClick:l=>a.editCoupon(s)}," 編輯 ",8,be),e("button",{type:"button",class:"btn btn-outline-danger",onClick:l=>a.deleteCoupon(s)}," 刪除 ",8,ge)])])]))),128))])]),ve]),o.coupons.length?(c(),E(u,{key:0,pages:o.pagination,onChangePage:a.getCoupons,class:"mt-auto"},null,8,["pages","onChangePage"])):Y("",!0)]),i(b,{"temp-coupon":o.tempCoupon,ref:"couponModalRef","is-new":o.isNew,onGetCoupons:a.getCoupons},null,8,["temp-coupon","is-new","onGetCoupons"])],64)}const Me=M(le,[["render",ye]]);export{Me as default};
