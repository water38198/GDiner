import{h as E}from"./moment-Cl4UOzQZ.js";import{_ as x,M,o as a,c as d,b as e,d as n,w as C,n as g,t as c,g as $,F as p,j as O,f as k,v as L,r as _,q as w}from"./index-BP2mD-gl.js";import{P as T}from"./PaginationComponent-CVF3ZIE_.js";var P={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:D,VITE_PATH:S}=P,U={props:{tempOrder:{type:Object}},emits:["getOrders"],data(){return{modalOrder:{user:{}},isLoading:!1,modal:null}},computed:{isChanged(){return JSON.stringify(this.tempOrder)===JSON.stringify(this.modalOrder)}},methods:{changePrice(o){const{id:t}=o;this.modalOrder.products[t].final_total=this.modalOrder.products[t].qty*this.modalOrder.products[t].product.price,this.modalOrder.products[t].total=this.modalOrder.products[t].final_total},async confirmOrder(){let o=0;o=Object.keys(this.modalOrder.products).reduce((t,i)=>{const f=this.modalOrder.products[i].coupon?this.modalOrder.products[i].coupon.percent/100:1;return t+this.modalOrder.products[i].final_total*f},0),this.modalOrder.total=o,this.isLoading=!0;try{const t=await this.$http.put(`${D}/v2/api/${S}/admin/order/${this.modalOrder.id}`,{data:this.modalOrder});this.$swal({icon:"success",title:`${t.data.message}`,didClose:()=>{this.modal.hide(),this.$emit("getOrders")}})}catch(t){this.$swal({title:"錯誤發生",icon:"error",text:`${t.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`,confirmButtonColor:"#3D081B"})}finally{this.isLoading=!1}},isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"請輸入正確的電話號碼"}},watch:{tempOrder(){this.modalOrder=JSON.parse(JSON.stringify(this.tempOrder))}},mounted(){this.modal=new M("#OrderModal")}},B={class:"modal fade",id:"OrderModal",tabindex:"-1","aria-labelledby":"OrderLabel","aria-hidden":"true"},I={class:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"},R={class:"modal-content"},N=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-2",id:"OrderModalLabel"},"編輯訂單"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),q={class:"modal-body"},A={class:"row"},F={key:0,class:"col-md-6"},H=e("h4",{class:"text-center fs-4 mb-2"},"客戶資料",-1),G={class:"mb-4"},J=e("label",{for:"name",class:"form-label"},"姓名",-1),Y={class:"mb-4"},j=e("label",{for:"tel",class:"form-label"},"電話",-1),z={class:"mb-4"},K=e("label",{for:"email",class:"form-label"},"Email",-1),Q={class:"mb-4"},W=e("label",{for:"address",class:"form-label"},"地址",-1),X=e("h4",null,"留言：",-1),Z={class:"col-md-6"},ee=e("h4",{class:"text-center fs-4 mb-3"},"購買的商品",-1),te={class:"table table-borderless align-middle text-nowrap"},se=e("thead",null,[e("tr",null,[e("th",{class:"text-center"},"商品名稱"),e("th",null,"數量")])],-1),oe={class:"text-center"},le={class:"input-group"},re=["onUpdate:modelValue","onChange"],ae={class:"modal-footer"},de=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),ne=["disabled"];function ie(o,t,i,f,l,m){const u=_("VField"),h=_("ErrorMessage"),v=_("VForm");return a(),d("div",B,[e("div",I,[e("div",R,[N,e("div",q,[n(v,{onSubmit:m.confirmOrder,id:"OrderForm"},{default:C(({errors:r})=>[e("div",A,[i.tempOrder.user?(a(),d("div",F,[H,e("div",G,[J,n(u,{type:"text",id:"name",placeholder:"請輸入姓名",modelValue:l.modalOrder.user.name,"onUpdate:modelValue":t[0]||(t[0]=s=>l.modalOrder.user.name=s),modelModifiers:{trim:!0},name:"姓名",rules:"required",class:g(["form-control",{"is-invalid":r.姓名}])},null,8,["modelValue","class"]),n(h,{name:"姓名",class:"invalid-feedback ps-3"})]),e("div",Y,[j,n(u,{type:"tel",id:"tel",placeholder:"請輸入電話",modelValue:l.modalOrder.user.tel,"onUpdate:modelValue":t[1]||(t[1]=s=>l.modalOrder.user.tel=s),modelModifiers:{trim:!0},name:"電話",class:g(["form-control",{"is-invalid":r.電話}]),rules:m.isPhone},null,8,["modelValue","rules","class"]),n(h,{name:"電話",class:"invalid-feedback ps-3"})]),e("div",z,[K,n(u,{type:"email",id:"email",placeholder:"請輸入Email",modelValue:l.modalOrder.user.email,"onUpdate:modelValue":t[2]||(t[2]=s=>l.modalOrder.user.email=s),modelModifiers:{trim:!0},name:"Email",rules:"required|email",class:g(["form-control",{"is-invalid":r.Email}])},null,8,["modelValue","class"]),n(h,{name:"Email",class:"invalid-feedback ps-3"})]),e("div",Q,[W,n(u,{type:"address",id:"address",placeholder:"請輸入地址",modelValue:l.modalOrder.user.address,"onUpdate:modelValue":t[3]||(t[3]=s=>l.modalOrder.user.address=s),modelModifiers:{trim:!0},name:"地址",rules:"required",class:g(["form-control",{"is-invalid":r.地址}])},null,8,["modelValue","class"]),n(h,{name:"地址",class:"invalid-feedback ps-3"})]),e("div",null,[X,e("p",null,c(l.modalOrder.message),1)])])):$("",!0),e("div",Z,[ee,e("table",te,[se,e("tbody",null,[(a(!0),d(p,null,O(l.modalOrder.products,s=>(a(),d("tr",{key:s.id},[e("td",oe,c(s.product.title),1),e("td",null,[e("div",le,[k(e("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":b=>s.qty=b,onChange:b=>m.changePrice(s)},null,40,re),[[L,s.qty,void 0,{number:!0}]])])])]))),128))])])])])]),_:1},8,["onSubmit"])]),e("div",ae,[de,e("button",{type:"submit",class:"btn btn-primary",form:"OrderForm",disabled:l.isLoading},"送出",8,ne)])])])])}const ce=x(U,[["render",ie]]);var me={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:y,VITE_PATH:V}=me,ue={components:{OrderModal:ce,PaginationComponent:T},data(){return{orders:[],pagination:{},tempOrder:{},isLoading:!1}},methods:{async getOrders(o=1){this.isLoading=!0;try{const t=await this.$http.get(`${y}/v2/api/${V}/admin/orders?page=${o}`);this.orders=t.data.orders,this.pagination=t.data.pagination}catch(t){this.$swal({icon:"error",title:"錯誤發生",text:t.response.data.message})}finally{this.isLoading=!1}},openOrderModal(o){this.tempOrder=o},deleteOrder(o){this.$swal({icon:"warning",title:"刪除訂單",text:`你確定要刪除 ${o} 這筆訂單嗎?`,showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確定"}).then(async t=>{if(t.isConfirmed)try{const i=await this.$http.delete(`${y}/v2/api/${V}/admin/order/${o}`);this.$swal({icon:"success",title:`${i.data.message}`,didClose:()=>{this.getOrders()}})}catch(i){this.$swal({icon:"error",title:"錯誤發生",text:i.response.data.message})}})},getMoment(o){return E(o).format("YYYY-MM-DD")}},mounted(){this.getOrders()}},he={class:"py-4 py-md-10"},_e=e("h2",{class:"text-center fs-1"},"訂單",-1),pe={class:"table-responsive"},be={class:"table mt-6 text-nowrap"},ge=e("thead",null,[e("tr",null,[e("th",null,"下單時間"),e("th",null,"ID"),e("th",null,"購買品項"),e("th",null,"使用者資訊"),e("th",null,"留言"),e("th",null,"訂單總額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Oe={class:"table-group-divider"},fe={class:"mb-0"},ve={class:"text-center"},ye={class:"text-center"},Ve={key:0,class:"text-green"},xe={key:1,class:"text-red"},$e={class:"btn-group",role:"group","aria-label":"edit button group"},Ee=["onClick"],Me=["onClick"];function Ce(o,t,i,f,l,m){const u=_("VLoading"),h=_("PaginationComponent"),v=_("OrderModal");return a(),d(p,null,[n(u,{active:l.isLoading},null,8,["active"]),e("div",he,[_e,e("div",pe,[e("table",be,[ge,e("tbody",Oe,[(a(!0),d(p,null,O(l.orders,r=>(a(),d("tr",{key:r.id},[e("td",null,c(m.getMoment(r.create_at*1e3)),1),e("td",null,c(r.id),1),e("td",null,[e("ol",null,[(a(!0),d(p,null,O(r.products,s=>(a(),d("li",{key:s.id},c(s.product.title)+" x "+c(s.qty),1))),128))])]),e("td",null,[e("ul",fe,[(a(!0),d(p,null,O(r.user,(s,b)=>(a(),d("li",{key:s},c(b)+" : "+c(s),1))),128))])]),e("td",null,c(r.message),1),e("td",ve,c(r.total),1),e("td",ye,[r.is_paid?(a(),d("span",Ve,"已付款")):(a(),d("span",xe,"尚未付款"))]),e("td",null,[e("div",$e,[e("button",{type:"button",class:"btn btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#OrderModal",onClick:s=>m.openOrderModal(r)}," 編輯 ",8,Ee),e("button",{type:"button",class:"btn btn-outline-danger",onClick:s=>m.deleteOrder(r.id)}," 刪除 ",8,Me)])])]))),128))])])]),l.orders.length?(a(),w(h,{key:0,pages:l.pagination,onChangePage:m.getOrders},null,8,["pages","onChangePage"])):$("",!0)]),n(v,{"temp-order":l.tempOrder,onGetOrders:m.getOrders},null,8,["temp-order","onGetOrders"])],64)}const Te=x(ue,[["render",Ce]]);export{Te as default};
