import{r as _,x as C,o as r,c,a as e,b as i,w as D,n as y,t as n,k as L,H as B,q as w,h as k,S as f,M as I,f as V,_ as R,e as U,F as x,g as M,B as S,u as A}from"./index-DGL7KspW.js";import{_ as F}from"./PaginationComponent-Cg0yYMQv.js";import{u as P}from"./index-Uc1gfLmD.js";const q={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},H={class:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"},N={class:"modal-content"},Y={class:"modal-body"},z={class:"container-fluid"},G={key:0,class:"row gy-4"},j={class:"col-12 col-md-6"},J={class:"col-12 col-md-6"},K={class:"col-12 col-md-6"},Q={class:"col-12 col-md-6"},W={class:"col-12"},X={class:"col-12"},Z={class:"form-check"},ee={class:"modal-footer"},te=["disabled"],se={__name:"OrderModal",props:{order:{type:Object,required:!0}},emits:["refresh"],setup(E,{emit:p}){const v=E,l=_({...v.order});C(()=>v.order,a=>{l.value={...a}});const m=_(!1),b=p,h=_(null),$=async()=>{const{VITE_URL:a,VITE_PATH:t}=q;try{m.value=!0;const s=await k.put(`${a}/v2/api/${t}/admin/order/${l.value.id}`,{data:l.value});f.fire({icon:"success",title:`${s.data.message}`,showConfirmButton:!1,timer:1500,didClose:()=>{m.value=!1,b("refresh"),I.getInstance(h.value).hide()}})}catch(s){f.fire({icon:"error",title:"錯誤",text:`${s.response.data.message||"請稍後再試"}`})}finally{m.value=!1}},d=a=>/^(09)[0-9]{8}$/.test(a)?!0:"請輸入正確的手機號碼";return(a,t)=>{const s=V("VField"),o=V("ErrorMessage"),T=V("VForm");return r(),c("div",{class:"modal fade",id:"OrderModal",tabindex:"-1","aria-labelledby":"OrderLabel","aria-hidden":"true",ref_key:"modalRef",ref:h},[e("div",H,[e("div",N,[t[13]||(t[13]=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-2 fw-bold",id:"ProductModalLabel"}," 編輯訂單"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Y,[i(T,{onSubmit:$,id:"OrderForm"},{default:D(({errors:g})=>[e("div",z,[t[11]||(t[11]=e("h4",{class:"text-center fs-4 fw-bold"},"客戶資料",-1)),l.value.user?(r(),c("div",G,[e("div",j,[t[5]||(t[5]=e("label",{for:"name",class:"form-label"},"姓名",-1)),i(s,{type:"text",id:"name",placeholder:"請輸入姓名",modelValue:l.value.user.name,"onUpdate:modelValue":t[0]||(t[0]=u=>l.value.user.name=u),modelModifiers:{trim:!0},name:"姓名",rules:"required",class:y(["form-control",{"is-invalid":g.姓名}])},null,8,["modelValue","class"]),i(o,{name:"姓名",class:"invalid-feedback"})]),e("div",J,[t[6]||(t[6]=e("label",{for:"tel",class:"form-label"},"電話",-1)),i(s,{type:"tel",id:"tel",placeholder:"請輸入電話",modelValue:l.value.user.tel,"onUpdate:modelValue":t[1]||(t[1]=u=>l.value.user.tel=u),modelModifiers:{trim:!0},name:"電話",class:y(["form-control",{"is-invalid":g.電話}]),rules:d},null,8,["modelValue","class"]),i(o,{name:"電話",class:"invalid-feedback"})]),e("div",K,[t[7]||(t[7]=e("label",{for:"email",class:"form-label"},"Email",-1)),i(s,{type:"email",id:"email",placeholder:"請輸入Email",modelValue:l.value.user.email,"onUpdate:modelValue":t[2]||(t[2]=u=>l.value.user.email=u),modelModifiers:{trim:!0},name:"Email",rules:"required|email",class:y(["form-control",{"is-invalid":g.Email}])},null,8,["modelValue","class"]),i(o,{name:"Email",class:"invalid-feedback"})]),e("div",Q,[t[8]||(t[8]=e("label",{for:"address",class:"form-label"},"地址",-1)),i(s,{type:"address",id:"address",placeholder:"請輸入地址",modelValue:l.value.user.address,"onUpdate:modelValue":t[3]||(t[3]=u=>l.value.user.address=u),modelModifiers:{trim:!0},name:"地址",rules:"required",class:y(["form-control",{"is-invalid":g.地址}])},null,8,["modelValue","class"]),i(o,{name:"地址",class:"invalid-feedback"})]),e("div",W,[t[9]||(t[9]=e("h4",null,"留言：",-1)),e("p",null,n(l.value.message),1)]),e("div",X,[e("div",Z,[L(e("input",{class:"form-check-input",type:"checkbox",id:"is_paid","onUpdate:modelValue":t[4]||(t[4]=u=>l.value.is_paid=u)},null,512),[[B,l.value.is_paid]]),t[10]||(t[10]=e("label",{class:"form-check-label",for:"is_paid"},"是否啟用",-1))])])])):w("",!0)])]),_:1})]),e("div",ee,[t[12]||(t[12]=e("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"},"取消",-1)),e("button",{type:"submit",class:"btn btn-primary",form:"OrderForm",disabled:m.value},"送出",8,te)])])])],512)}}},O={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},le={class:"position-relative container py-10"},ae={class:"table-responsive"},oe={class:"table align-middle text-nowrap"},ne={class:"table-group-divider"},ie={type:"i"},re={type:"none"},de={class:"order-message"},ue={class:"text-center"},ce={class:"text-center"},me={key:0,class:"text-success"},pe={key:1,class:"text-danger"},_e={class:"btn-group",role:"group","aria-label":"edit button group"},fe=["onClick"],ve=["onClick"],be={__name:"AdminOrders",setup(E){const p=_(!1),v=_([]),l=_({}),m=async()=>{const{VITE_URL:d,VITE_PATH:a}=O;try{p.value=!0;const t=await k.get(`${d}/v2/api/${a}/admin/orders`);v.value=t.data.orders,l.value=t.data.pagination}catch(t){f.fire({icon:"error",title:"錯誤",text:`${t.response.data.message||"請稍後再試"}`})}finally{p.value=!1}};U(()=>{m()});const b=_({}),h=d=>{b.value={...d}},$=d=>{f.fire({title:`確定要刪除訂單${d.id}嗎？`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",confirmButtonColor:"#d33",cancelButtonText:"取消"}).then(async a=>{if(a.isConfirmed)try{p.value=!0;const{VITE_URL:t,VITE_PATH:s}=O,o=await k.delete(`${t}/v2/api/${s}/admin/order/${d.id}`);f.fire({title:o.data.message,icon:"success",showConfirmButton:!1,timer:2e3})}catch(t){f.fire({icon:"error",title:"錯誤",text:`${t.response.data.message||"請稍後再試"}`})}finally{p.value=!1,m()}})};return(d,a)=>{const t=V("VLoading");return r(),c(x,null,[e("div",le,[i(t,{active:p.value,"is-full-page":!1},null,8,["active"]),a[1]||(a[1]=e("h2",{class:"text-center fw-bold"},"訂單管理",-1)),e("div",ae,[e("table",oe,[a[0]||(a[0]=e("thead",null,[e("tr",null,[e("th",null,"下單時間"),e("th",null,"ID"),e("th",null,"品項"),e("th",null,"買家資訊"),e("th",null,"留言"),e("th",null,"總額"),e("th",null,"付款"),e("th",{class:"text-center"},"編輯")])],-1)),e("tbody",ne,[(r(!0),c(x,null,M(v.value,s=>(r(),c("tr",{key:s.id},[e("td",null,n(A(P)(s.create_at*1e3,"YYYY-MM-DD")),1),e("td",null,n(s.id),1),e("td",null,[e("ol",ie,[(r(!0),c(x,null,M(s.products,o=>(r(),c("li",{key:o.id},n(o.product.title)+" x "+n(o.qty),1))),128))])]),e("td",null,[e("ul",re,[e("li",null,"姓名："+n(s.user.name),1),e("li",null,"電郵："+n(s.user.email),1),e("li",null,"電話："+n(s.user.tel),1),e("li",null,"用餐："+n(s.user.type),1),e("li",null,"日期："+n(s.user.reservation_date),1),e("li",null,"時間："+n(s.user.reservation_time),1)])]),e("td",de,n(s.message),1),e("td",ue,n(Math.floor(s.total)),1),e("td",ce,[s.is_paid?(r(),c("span",me,"已付款")):(r(),c("span",pe,"尚未付款"))]),e("td",null,[e("div",_e,[e("button",{type:"button",class:"btn btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#OrderModal",onClick:o=>h(s)},"編輯",8,fe),e("button",{type:"button",class:"btn btn-outline-danger",onClick:o=>$(s)},"刪除",8,ve)])])]))),128))])])]),l.value.total_pages>1?(r(),S(F,{key:0,pagination:l.value,"change-page":m},null,8,["pagination"])):w("",!0)]),i(se,{order:b.value},null,8,["order"])],64)}}},Ve=R(be,[["__scopeId","data-v-d6560109"]]);export{Ve as default};
