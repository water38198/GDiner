import{r as f,l as T,o as u,c,a as e,b as n,w as C,n as g,t as o,k as D,E as L,x as I,h as E,S as _,M as R,f as V,_ as U,e as B,F as x,g as M,u as S}from"./index-CmgD-ALe.js";import{u as A}from"./index-B4CFkyds.js";const F={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},P={class:"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"},q={class:"modal-content"},H={class:"modal-body"},N={class:"container-fluid"},Y={key:0,class:"row gy-4"},z={class:"col-12 col-md-6"},G={class:"col-12 col-md-6"},j={class:"col-12 col-md-6"},J={class:"col-12 col-md-6"},K={class:"col-12"},Q={class:"col-12"},W={class:"form-check"},X={class:"modal-footer"},Z=["disabled"],ee={__name:"OrderModal",props:{order:{type:Object,required:!0}},emits:["refresh"],setup(k,{emit:m}){const v=k,l=f({...v.order});T(()=>v.order,t=>{l.value={...t}});const p=f(!1),$=m,h=f(null),d=async()=>{const{VITE_URL:t,VITE_PATH:s}=F;try{p.value=!0;const a=await E.put(`${t}/v2/api/${s}/admin/order/${l.value.id}`,{data:l.value});_.fire({icon:"success",title:`${a.data.message}`,showConfirmButton:!1,timer:1500,didClose:()=>{p.value=!1,$("refresh"),R.getInstance(h.value).hide()}})}catch(a){_.fire({icon:"error",title:"錯誤",text:`${a.response.data.message||"請稍後再試"}`})}finally{p.value=!1}},i=t=>/^(09)[0-9]{8}$/.test(t)?!0:"請輸入正確的手機號碼";return(t,s)=>{const a=V("VField"),b=V("ErrorMessage"),w=V("VForm");return u(),c("div",{class:"modal fade",id:"OrderModal",tabindex:"-1","aria-labelledby":"OrderLabel","aria-hidden":"true",ref_key:"modalRef",ref:h},[e("div",P,[e("div",q,[s[13]||(s[13]=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-2 fw-bold",id:"ProductModalLabel"}," 編輯訂單"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",H,[n(w,{onSubmit:d,id:"OrderForm"},{default:C(({errors:y})=>[e("div",N,[s[11]||(s[11]=e("h4",{class:"text-center fs-4 fw-bold"},"客戶資料",-1)),l.value.user?(u(),c("div",Y,[e("div",z,[s[5]||(s[5]=e("label",{for:"name",class:"form-label"},"姓名",-1)),n(a,{type:"text",id:"name",placeholder:"請輸入姓名",modelValue:l.value.user.name,"onUpdate:modelValue":s[0]||(s[0]=r=>l.value.user.name=r),modelModifiers:{trim:!0},name:"姓名",rules:"required",class:g(["form-control",{"is-invalid":y.姓名}])},null,8,["modelValue","class"]),n(b,{name:"姓名",class:"invalid-feedback"})]),e("div",G,[s[6]||(s[6]=e("label",{for:"tel",class:"form-label"},"電話",-1)),n(a,{type:"tel",id:"tel",placeholder:"請輸入電話",modelValue:l.value.user.tel,"onUpdate:modelValue":s[1]||(s[1]=r=>l.value.user.tel=r),modelModifiers:{trim:!0},name:"電話",class:g(["form-control",{"is-invalid":y.電話}]),rules:i},null,8,["modelValue","class"]),n(b,{name:"電話",class:"invalid-feedback"})]),e("div",j,[s[7]||(s[7]=e("label",{for:"email",class:"form-label"},"Email",-1)),n(a,{type:"email",id:"email",placeholder:"請輸入Email",modelValue:l.value.user.email,"onUpdate:modelValue":s[2]||(s[2]=r=>l.value.user.email=r),modelModifiers:{trim:!0},name:"Email",rules:"required|email",class:g(["form-control",{"is-invalid":y.Email}])},null,8,["modelValue","class"]),n(b,{name:"Email",class:"invalid-feedback"})]),e("div",J,[s[8]||(s[8]=e("label",{for:"address",class:"form-label"},"地址",-1)),n(a,{type:"address",id:"address",placeholder:"請輸入地址",modelValue:l.value.user.address,"onUpdate:modelValue":s[3]||(s[3]=r=>l.value.user.address=r),modelModifiers:{trim:!0},name:"地址",rules:"required",class:g(["form-control",{"is-invalid":y.地址}])},null,8,["modelValue","class"]),n(b,{name:"地址",class:"invalid-feedback"})]),e("div",K,[s[9]||(s[9]=e("h4",null,"留言：",-1)),e("p",null,o(l.value.message),1)]),e("div",Q,[e("div",W,[D(e("input",{class:"form-check-input",type:"checkbox",id:"is_paid","onUpdate:modelValue":s[4]||(s[4]=r=>l.value.is_paid=r)},null,512),[[L,l.value.is_paid]]),s[10]||(s[10]=e("label",{class:"form-check-label",for:"is_paid"},"是否啟用",-1))])])])):I("",!0)])]),_:1})]),e("div",X,[s[12]||(s[12]=e("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"},"取消",-1)),e("button",{type:"submit",class:"btn btn-primary",form:"OrderForm",disabled:p.value},"送出",8,Z)])])])],512)}}},O={BASE_URL:"/GDiner/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PATH:"payzoom",VITE_URL:"https://vue3-course-api.hexschool.io"},se={class:"position-relative container py-10"},le={class:"table-responsive"},te={class:"table align-middle text-nowrap"},ae={class:"table-group-divider"},oe={type:"i"},ne={class:"order-message"},ie={class:"text-center"},de={class:"text-center"},re={key:0,class:"text-success"},ue={key:1,class:"text-danger"},ce={class:"btn-group",role:"group","aria-label":"edit button group"},me=["onClick"],pe=["onClick"],_e={__name:"AdminOrders",setup(k){const m=f(!1),v=f([]),l=async()=>{const{VITE_URL:d,VITE_PATH:i}=O;try{m.value=!0;const t=await E.get(`${d}/v2/api/${i}/admin/orders`);v.value=t.data.orders}catch(t){_.fire({icon:"error",title:"錯誤",text:`${t.response.data.message||"請稍後再試"}`})}finally{m.value=!1}};B(()=>{l()});const p=f({}),$=d=>{p.value={...d}},h=d=>{_.fire({title:`確定要刪除訂單${d.id}嗎？`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",confirmButtonColor:"#d33",cancelButtonText:"取消"}).then(async i=>{if(i.isConfirmed)try{m.value=!0;const{VITE_URL:t,VITE_PATH:s}=O,a=await E.delete(`${t}/v2/api/${s}/admin/order/${d.id}`);_.fire({title:a.data.message,icon:"success",showConfirmButton:!1,timer:2e3})}catch(t){_.fire({icon:"error",title:"錯誤",text:`${t.response.data.message||"請稍後再試"}`})}finally{m.value=!1,l()}})};return(d,i)=>{const t=V("VLoading");return u(),c(x,null,[e("div",se,[n(t,{active:m.value,"is-full-page":!1},null,8,["active"]),i[1]||(i[1]=e("h2",{class:"text-center fw-bold"},"訂單管理",-1)),e("div",le,[e("table",te,[i[0]||(i[0]=e("thead",null,[e("tr",null,[e("th",null,"下單時間"),e("th",null,"ID"),e("th",null,"品項"),e("th",null,"買家資訊"),e("th",null,"留言"),e("th",null,"總額"),e("th",null,"付款"),e("th",{class:"text-center"},"編輯")])],-1)),e("tbody",ae,[(u(!0),c(x,null,M(v.value,s=>(u(),c("tr",{key:s.id},[e("td",null,o(S(A)(s.create_at*1e3,"YYYY-MM-DD")),1),e("td",null,o(s.id),1),e("td",null,[e("ol",oe,[(u(!0),c(x,null,M(s.products,a=>(u(),c("li",{key:a.id},o(a.product.title)+" x "+o(a.qty),1))),128))])]),e("td",null,[e("ul",null,[e("li",null,"姓名："+o(s.user.name),1),e("li",null,"電郵："+o(s.user.email),1),e("li",null,"地址："+o(s.user.address),1),e("li",null,"電話："+o(s.user.tel),1),e("li",null,"用餐："+o(s.user.type),1)])]),e("td",ne,o(s.message),1),e("td",ie,o(s.total),1),e("td",de,[s.is_paid?(u(),c("span",re,"已付款")):(u(),c("span",ue,"尚未付款"))]),e("td",null,[e("div",ce,[e("button",{type:"button",class:"btn btn-outline-primary","data-bs-toggle":"modal","data-bs-target":"#OrderModal",onClick:a=>$(s)},"編輯",8,me),e("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>h(s)},"刪除",8,pe)])])]))),128))])])])]),n(ee,{order:p.value},null,8,["order"])],64)}}},be=U(_e,[["__scopeId","data-v-ba28d964"]]);export{be as default};
