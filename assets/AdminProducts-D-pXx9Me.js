import{_ as T,o as a,c as n,d as r,e as x,b as e,t as g,n as m,i as k,F as P,l as U,g as V,v as C,h as E,q as N,r as b,s as z}from"./index-JINe9Ytb.js";import{P as D}from"./PaginationComponent-Bx7KWUck.js";var I={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:L,VITE_PATH:M}=I,$={props:{tempProduct:{type:Object},isNew:Boolean},emits:["confirmProduct"],data(){return{modalProduct:{},newTag:""}},methods:{autoClose(i){i.target.nodeName==="DIALOG"&&this.$refs.dialog.close()},showModal(){this.$refs.dialog.showModal()},close(){this.$refs.dialog.close()},addNewImages(){this.modalProduct.imagesUrl&&(this.modalProduct.imagesUrl=[]);const i=this.modalProduct.imagesUrl.length;this.modalProduct.imagesUrl[i-1]!==""&&this.modalProduct.imagesUrl.push("")},async upload(i,t){const p=t.target.files[0],h=new FormData;h.append("file-to-upload",p);try{const o=await this.$http.post(`${L}/v2/api/${M}/admin/upload`,h);if(this.addNewImages(),i==="images"){const d=this.modalProduct.imagesUrl.length;this.modalProduct.imagesUrl[d-1]=o.data.imageUrl}else i==="image"&&(this.modalProduct.imageUrl=o.data.imageUrl);t.target.value=""}catch(o){this.$swal({icon:"error",title:"錯誤發生",text:o.response.data.message})}},addTag(){if(this.newTag==="")return;this.modalProduct.tags||(this.modalProduct.tags=[]);const i=this.modalProduct.tags.length,t=this.modalProduct.tags[i-1]||"";this.newTag===t||t===void 0||(this.modalProduct.tags.push(this.newTag),this.newTag="")},deleteTag(i){this.modalProduct.tags=this.modalProduct.tags.filter(t=>t!==i)}},watch:{tempProduct(){this.modalProduct={...this.tempProduct}}}},R={class:"bg-primary p-4 flex justify-between items-center"},q={class:"text-white"},B={class:"grid grid-cols-12 gap-6 p-3"},S={class:"col-span-4"},A={class:"input-group"},O=e("label",{for:"imagUrl",class:"block"},"主要圖片",-1),F=["src"],H={action:"/api/thisismycourse2/admin/upload",enctype:"multipart/form-data",method:"post",class:"my-4"},j=e("h4",{class:"font-size-5 mb-4"},"多圖新增",-1),G={class:"flex justify-between mb-2"},J={for:"images-1"},K=["onClick"],Q={class:"input-group"},W=["onUpdate:modelValue"],X=["src"],Y={action:"/api/thisismycourse2/admin/upload",enctype:"multipart/form-data",method:"post",class:"mt-10"},Z={class:"col-span-8"},ee={class:"grid grid-cols-2 gap-col-6 gap-row-4"},te={class:"input-group col-span-2"},oe=e("label",{for:"title"},"名稱：",-1),se={class:"input-group"},le=e("label",{for:"category"},"分類：",-1),ie=e("option",{value:"主食"},"主食",-1),de=e("option",{value:"沙拉"},"沙拉",-1),re=e("option",{value:"湯品"},"湯品",-1),ae=e("option",{value:"副食"},"副食",-1),ne=e("option",{value:"甜點"},"甜點",-1),ce=e("option",{value:"飲料"},"飲料",-1),ue=e("option",{value:"套餐"},"套餐",-1),pe={class:"input-group"},me=e("label",{for:"unit"},"單位：",-1),he=e("datalist",{id:"units"},[e("option",{value:"碗"}),e("option",{value:"客"}),e("option",{value:"杯"}),e("option",{value:"份"}),e("option",{value:"個"})],-1),ge={class:"input-group"},_e=e("label",{for:"origin_price"},"原價：",-1),be={class:"input-group"},fe=e("label",{for:"price"},"售價：",-1),ve={class:"input-group"},Pe=e("label",{for:"veggie"},"素食:",-1),ye=e("option",{value:"全素",class:"text-green-700"},"全素",-1),we=e("option",{value:"蛋奶素",class:"text-yellow-700"},"蛋奶素",-1),xe=e("option",{value:"葷食",class:"text-red"},"葷食",-1),Ve={class:"input-group col-span-2"},ke=e("label",{for:"tags"},"標籤：",-1),Ue={class:"col-span-2"},Ce={key:0,class:"mb-4 flex"},Te={class:"flex"},Ee={class:"font-size-4 px-4"},Ne=["onClick"],ze=e("div",{class:"i-ic:baseline-close"},null,-1),De=[ze],Ie={class:"input-group col-span-2"},Le=e("label",{for:"description"},"產品敘述:",-1),Me={class:"input-group col-span-2"},$e=e("label",{for:"content"},"內容說明:",-1),Re=e("label",{for:"is_enabled"},"是否啟用",-1),qe={class:"text-end p-3 border-t border-solid border-#dee2e6"},Be=e("button",{type:"submit",class:"m-1 px-3 py-1.5 text-secondary bg-primary border-0 rd cursor-pointer hover:bg-primary-light"},"確定",-1);function Se(i,t,p,h,o,d){const c=b("VField"),u=b("ErrorMessage"),y=b("VForm");return a(),n("dialog",{ref:"dialog",class:"max-w-1140px w-100% border-0 rd p-0 backdrop:backdrop-blur-3",onClick:t[19]||(t[19]=(...l)=>d.autoClose&&d.autoClose(...l))},[r(y,{onSubmit:t[18]||(t[18]=l=>i.$emit("confirmProduct",o.modalProduct))},{default:x(({errors:l})=>[e("div",R,[e("h3",q,g(p.isNew?"新增產品":"編輯產品"),1),e("button",{type:"button",class:"i-ic:baseline-close p-2 text-white font-size-4 hover:cursor-pointer",onClick:t[0]||(t[0]=s=>d.close())})]),e("div",null,[e("div",B,[e("div",S,[e("div",A,[O,r(c,{name:"主要圖片",id:"imageUrl",type:"text",placeholder:"請輸入圖片連結",modelValue:o.modalProduct.imageUrl,"onUpdate:modelValue":t[1]||(t[1]=s=>o.modalProduct.imageUrl=s),class:m({invalid:l.主要圖片}),rules:"required"},null,8,["modelValue","class"]),r(u,{name:"主要圖片",class:"block ps-2 pt-2 text-red-500 font-size-3"}),o.modalProduct.imageUrl?(a(),n("img",{key:0,src:o.modalProduct.imageUrl,alt:"產品主要照片"},null,8,F)):k("",!0)]),e("form",H,[e("input",{type:"file",name:"file-to-upload",onChange:t[2]||(t[2]=s=>d.upload("image",s))},null,32)]),e("div",null,[j,(a(!0),n(P,null,U(o.modalProduct.imagesUrl,(s,_)=>(a(),n("div",{key:s,class:"mb-4"},[e("div",G,[e("label",J,"圖片網址"+g(_+1),1),e("button",{type:"button",class:"i-ic:baseline-close font-size-5 opacity-50 hover:cursor-pointer hover:opacity-75",onClick:w=>o.modalProduct.imagesUrl.splice(_,1)},null,8,K)]),e("div",Q,[V(e("input",{type:"text","onUpdate:modelValue":w=>o.modalProduct.imagesUrl[_]=w,placeholder:"請輸入圖片網址",class:",b-2"},null,8,W),[[C,o.modalProduct.imagesUrl[_]]])]),e("img",{src:s,alt:"產品照片"},null,8,X)]))),128)),e("button",{type:"button",class:"inline-block w-100% bg-transparent border-primary border-solid border-1 rd text-primary py-1 mb-1 cursor-pointer hover:bg-primary hover:text-secondary",onClick:t[3]||(t[3]=(...s)=>d.addNewImages&&d.addNewImages(...s))}," 新增圖片網址 "),e("form",Y,[e("input",{type:"file",name:"file-to-upload",onChange:t[4]||(t[4]=s=>d.upload("images",s))},null,32)])])]),e("div",Z,[e("div",ee,[e("div",te,[oe,r(c,{type:"text",id:"title",name:"名稱",rules:"required",placeholder:"請輸入標題",modelValue:o.modalProduct.title,"onUpdate:modelValue":t[5]||(t[5]=s=>o.modalProduct.title=s),class:m({invalid:l.名稱})},null,8,["modelValue","class"]),r(u,{name:"名稱",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",se,[le,r(c,{as:"select",name:"分類",rules:"required",id:"category",class:m({invalid:l.分類}),modelValue:o.modalProduct.category,"onUpdate:modelValue":t[6]||(t[6]=s=>o.modalProduct.category=s)},{default:x(()=>[ie,de,re,ae,ne,ce,ue]),_:2},1032,["class","modelValue"]),r(u,{name:"分類",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",pe,[me,r(c,{type:"text",id:"unit",placeholder:"請輸入單位",modelValue:o.modalProduct.unit,"onUpdate:modelValue":t[7]||(t[7]=s=>o.modalProduct.unit=s),list:"units",name:"單位",rules:"required",class:m({invalid:l.單位}),autocomplete:"off"},null,8,["modelValue","class"]),he,r(u,{name:"單位",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",ge,[_e,r(c,{type:"number",name:"原價",id:"origin_price",placeholder:"請輸入原價",min:"0",rules:"required|min_value:0",class:m({invalid:l.原價}),modelValue:o.modalProduct.origin_price,"onUpdate:modelValue":t[8]||(t[8]=s=>o.modalProduct.origin_price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),r(u,{name:"原價",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",be,[fe,r(c,{type:"number",id:"price",placeholder:"請輸入售價",min:"0",modelValue:o.modalProduct.price,"onUpdate:modelValue":t[9]||(t[9]=s=>o.modalProduct.price=s),modelModifiers:{number:!0},name:"售價",rules:{required:!0,max_value:o.modalProduct.origin_price,min_value:0},class:m({invalid:l.售價})},null,8,["modelValue","rules","class"]),r(u,{name:"售價",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",ve,[Pe,r(c,{as:"select",id:"veggie",modelValue:o.modalProduct.veggie,"onUpdate:modelValue":t[10]||(t[10]=s=>o.modalProduct.veggie=s),name:"素食",rules:"required",class:m({invalid:l.素食})},{default:x(()=>[ye,we,xe]),_:2},1032,["modelValue","class"]),r(u,{name:"素食",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",Ve,[ke,V(e("input",{type:"text",id:"tags","onUpdate:modelValue":t[11]||(t[11]=s=>o.newTag=s),onKeydown:t[12]||(t[12]=E((...s)=>d.addTag&&d.addTag(...s),["enter"]))},null,544),[[C,o.newTag,void 0,{trim:!0}]])]),e("div",Ue,[o.modalProduct.tags?(a(),n("div",Ce,[e("ul",Te,[(a(!0),n(P,null,U(o.modalProduct.tags,(s,_)=>(a(),n("li",{key:`${_}+${s}`,class:"flex px-2 py-2 border-1 border-solid border-primary rd me-2"},[e("span",Ee,g(s),1),e("a",{class:"border-0 bg-transparent p-0 hover:cursor-pointer",onClick:w=>d.deleteTag(s)},De,8,Ne)]))),128))])])):k("",!0),e("button",{type:"button",class:"border-0 rd bg-primary text-white px-4 py-2 hover:cursor-pointer hover:bg-primary-light",onClick:t[13]||(t[13]=(...s)=>d.addTag&&d.addTag(...s))},"新增標籤")]),e("div",Ie,[Le,r(c,{as:"textarea",id:"description",rows:"6",modelValue:o.modalProduct.description,"onUpdate:modelValue":t[14]||(t[14]=s=>o.modalProduct.description=s),name:"產品敘述",rules:"required",class:m({invalid:l.產品敘述})},null,8,["modelValue","class"]),r(u,{name:"產品敘述",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",Me,[$e,r(c,{as:"textarea",id:"content",rows:"4",modelValue:o.modalProduct.content,"onUpdate:modelValue":t[15]||(t[15]=s=>o.modalProduct.content=s),name:"內容說明",rules:"required",class:m({invalid:l.內容說明})},null,8,["modelValue","class"]),r(u,{name:"內容說明",class:"block ps-2 pt-2 text-red-500 font-size-3"})]),e("div",null,[V(e("input",{type:"checkbox",id:"is_enabled","onUpdate:modelValue":t[16]||(t[16]=s=>o.modalProduct.is_enabled=s),"true-value":1,"false-value":0},null,512),[[N,o.modalProduct.is_enabled]]),Re])])])]),e("div",qe,[e("button",{type:"button",class:"m-1 px-3 py-1.5 bg-transparent text-#6c757d border-1 border-solid border-#6c757d rd hover:cursor-pointer hover:bg-#5c636a hover:text-white",onClick:t[17]||(t[17]=s=>d.close())},"取消"),Be])])]),_:1})],512)}const Ae=T($,[["render",Se]]);var Oe={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:v}=Oe,Fe={components:{ProductModal:Ae,PaginationComponent:D},data(){return{products:[],tempProduct:{},isNew:!0,pagination:{},isLoading:!1}},methods:{async getProducts(i=1){this.isLoading=!0;try{const t=await this.$http.get(`${f}/v2/api/${v}/admin/products?page=${i}`);this.products=t.data.products,this.pagination=t.data.pagination}catch(t){this.$swal({icon:"error",title:"錯誤發生",text:t.response.data.message})}finally{this.isLoading=!1}},addNewProduct(){this.isNew=!0,this.tempProduct={},this.$refs.dialog.showModal()},editProduct(i){this.tempProduct=JSON.parse(JSON.stringify(i)),this.isNew=!1,this.$refs.dialog.showModal()},async confirmProduct(i){const t=this.isNew?"post":"put",p=this.isNew?`${f}/v2/api/${v}/admin/product`:`${f}/v2/api/${v}/admin/product/${i.id}`;this.isNew&&(i.created=Date.now());try{const h=await this.$http[t](p,{data:i});this.$swal({title:`${h.data.message}`,icon:"success",didClose:()=>{this.getProducts(this.pagination.current_page||1)}}),this.$refs.dialog.close()}catch(h){this.$swal({icon:"error",title:"錯誤發生",text:`${h.response.data.message}`})}},deleteProduct(i){this.$swal({title:`你確定要刪除 ${i.title} 嗎?`,showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(async t=>{if(t.isConfirmed)try{const p=await this.$http.delete(`${f}/v2/api/${v}/admin/product/${i.id}`);this.$swal({icon:"success",text:p.data.message,didClose:()=>{this.getProducts(this.pagination.current_page||1)}})}catch(p){this.$swal({icon:"error",text:p.response.data.message})}})}},mounted(){this.getProducts()}},He={class:"p-10"},je=e("h2",{class:"font-size-12"},"產品",-1),Ge={class:"text-end mt-6"},Je={class:"relative min-h-100"},Ke={class:"w-100% mt-6"},Qe=e("thead",{class:"border-b-1 border-black border-solid fw-bold text-left"},[e("tr",null,[e("th",{width:"120"},"縮圖"),e("th",{width:"120"},"分類"),e("th",null,"產品名稱"),e("th",{width:"120",class:"text-end"},"原價"),e("th",{width:"120",class:"text-end"},"售價"),e("th",{width:"100",class:"text-center"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),We=["src","alt"],Xe={class:"text-end"},Ye={class:"text-end"},Ze={class:"text-center"},et={key:0,class:"text-#198754"},tt={key:1,class:"text-red"},ot=["onClick"],st=["onClick"];function lt(i,t,p,h,o,d){const c=b("VLoading"),u=b("ProductModal"),y=b("PaginationComponent");return a(),n(P,null,[e("div",He,[je,e("div",Ge,[e("button",{type:"button",class:"bg-primary border-0 text-white cursor-pointer inline-block px-3 py-1.5 rd font-size-4 hover:bg-primary-light",onClick:t[0]||(t[0]=(...l)=>d.addNewProduct&&d.addNewProduct(...l))},"建立新的產品")]),e("div",Je,[r(c,{active:o.isLoading,"is-full-page":!1},null,8,["active"]),e("table",Ke,[Qe,e("tbody",null,[(a(!0),n(P,null,U(o.products,l=>(a(),n("tr",{class:"border-b border-#DEE2E6 border-solid",key:l.id},[e("td",null,[e("img",{src:l.imageUrl,alt:`${l.title}的圖片`,width:"120",height:"100"},null,8,We)]),e("td",null,g(l.category),1),e("td",null,g(l.title),1),e("td",Xe,g(l.origin_price),1),e("td",Ye,g(l.price),1),e("td",Ze,[l.is_enabled?(a(),n("span",et,"啟用")):(a(),n("span",tt,"未啟用"))]),e("td",null,[e("div",null,[e("button",{type:"button",class:"text-#0d6efd bg-transparent border-1 border-#0d6efd border-solid rd-tl rd-bl px-2 py-1 hover:bg-#0d6efd hover:text-white hover:cursor-pointer",onClick:s=>d.editProduct(l)}," 編輯 ",8,ot),e("button",{type:"button",class:"text-#dc3545 bg-transparent border-1 border-#de3545 border-solid rd-tr rd-br px-2 py-1 hover:bg-#de3545 hover:text-white hover:cursor-pointer",onClick:s=>d.deleteProduct(l)}," 刪除 ",8,st)])])]))),128))])])])]),r(u,{onConfirmProduct:d.confirmProduct,"temp-product":o.tempProduct,"is-new":o.isNew,ref:"dialog"},null,8,["onConfirmProduct","temp-product","is-new"]),o.products.length?(a(),z(y,{key:0,pages:o.pagination,onChangePage:d.getProducts},null,8,["pages","onChangePage"])):k("",!0)],64)}const rt=T(Fe,[["render",lt]]);export{rt as default};
