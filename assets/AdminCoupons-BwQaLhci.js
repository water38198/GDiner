import{r as c,w as Y,e as D,f as _,g as x,j as i,k as N,h as e,t as $,n as y,q as T,m as L,E as S,l as U,o as R,F as E,B as q,J as F,x as P,y as A,C as w,S as m,L as I}from"./index-BrG9BiK3.js";import{h as k}from"./moment-Cl4UOzQZ.js";import{P as O}from"./PaginationComponent-JPFXS4Qa.js";const j={class:"bg-#212529 p-4 flex justify-between items-center"},G={class:"text-white"},H={class:"grid grid-cols-2 gap-6 p-5"},J={class:"input-group"},K=e("label",{for:"name"},"名稱：",-1),Q={class:"input-group"},W=e("label",{for:"code"},"優惠碼：",-1),X={class:"input-group"},Z=e("label",{for:"due_date"},"到期日：",-1),ee={class:"input-group mb-4"},te=e("label",{for:"percent"},"優惠比例：",-1),oe={for:"is_paid"},se={class:"text-end p-3 border-t border-solid border-#dee2e6"},le=e("button",{type:"submit",class:"m-1 px-3 py-1.5 text-white bg-#0d6efd border-0 rd hover:cursor-pointer hover:bg-#0b5ed7"},"確定",-1),ae={__name:"CouponModal",props:["tempCoupon","isNew"],setup(V,{expose:h}){const p=V,s=c(p.tempCoupon),d=c(),r=c("");function v(f){f.target.nodeName==="DIALOG"&&d.value.close()}return Y(()=>p.tempCoupon,()=>{s.value={...p.tempCoupon},s.value.due_date?r.value=k(s.value.due_date*1e3).format("YYYY-MM-DD"):r.value=k(new Date().getTime()).format("YYYY-MM-DD"),s.value.is_enabled||(s.value.is_enabled=0)}),Y(()=>r.value,()=>{s.value.due_date=new Date(r.value).getTime()/1e3}),h({dialog:d}),(f,t)=>{const u=D("VField"),g=D("ErrorMessage"),M=D("VForm");return _(),x("dialog",{ref_key:"dialog",ref:d,class:"max-w-1140px w-100% border-0 rd p-0 backdrop:backdrop-blur-3",onClick:v},[i(M,{method:"dialog",onSubmit:t[7]||(t[7]=b=>f.$emit("confirmCoupon",s.value))},{default:N(({errors:b})=>[e("div",j,[e("h3",G,$(V.isNew?"新增":"編輯"),1),e("button",{type:"button",class:"i-ic:baseline-close p-2 text-white font-size-4 cursor-pointer",onClick:t[0]||(t[0]=a=>d.value.close())})]),e("div",H,[e("div",J,[K,i(u,{type:"text",id:"name",name:"名稱",rules:"required",placeholder:"請輸入名稱",modelValue:s.value.title,"onUpdate:modelValue":t[1]||(t[1]=a=>s.value.title=a),modelModifiers:{trim:!0},class:y({invalid:b.名稱})},null,8,["modelValue","class"]),i(g,{name:"名稱",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",Q,[W,i(u,{type:"text",id:"code",name:"優惠碼",rules:"required",placeholder:"請輸入優惠碼",class:y({invalid:b.優惠碼}),modelValue:s.value.code,"onUpdate:modelValue":t[2]||(t[2]=a=>s.value.code=a),modelModifiers:{trim:!0}},null,8,["class","modelValue"]),i(g,{name:"優惠碼",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",X,[Z,i(u,{type:"date",id:"due_date",name:"到期日",rules:"required",pattern:"yyyy-MM-dd",class:y({invalid:b.到期日}),modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=a=>r.value=a),min:T(k)().format("YYYY-MM-DD")},null,8,["class","modelValue","min"]),i(g,{name:"到期日",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",ee,[te,i(u,{type:"number",id:"percent",placeholder:"請輸入折扣百分比",name:"優惠比例",rules:"required||max_value:100||min_value:0",modelValue:s.value.percent,"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.percent=a),modelModifiers:{number:!0},min:"0",class:y({invalid:b.優惠比例}),max:"100"},null,8,["modelValue","class"]),i(g,{name:"優惠比例",class:"block ps-3 pt-2 text-red-500 font-size-3"})]),e("div",null,[e("label",oe,[L(e("input",{type:"checkbox",id:"is_paid","onUpdate:modelValue":t[5]||(t[5]=a=>s.value.is_enabled=a),class:"custom-checkbox","true-value":1,"false-value":0},null,512),[[S,s.value.is_enabled]]),U(" 是否啟用 ")])])]),e("div",se,[e("button",{type:"button",class:"m-1 px-3 py-1.5 bg-transparent text-#6c757d border-1 border-solid border-#6c757d rd hover:cursor-pointer hover:bg-#5c636a hover:text-white",onClick:t[6]||(t[6]=a=>d.value.close())},"取消"),le])]),_:1})],512)}}};var ne={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payzoom",BASE_URL:"/GDiner/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const ie={class:"p-10 flex flex-col h-100%"},de=e("h2",{class:"font-size-12"},"優惠券",-1),re={class:"relative min-h-100"},ue={class:"w-100% my-6"},ce=e("thead",{class:"border-b-1 border-black border-solid fw-bold text-left"},[e("tr",null,[e("th",{width:"120"}," 名稱 "),e("th",null,"優惠碼"),e("th",null," 到期日 "),e("th",null," 百分比 "),e("th",{width:"100",class:"text-center"}," 是否啟用 "),e("th",{width:"120"}," 編輯 ")])],-1),pe={class:"text-center"},me={key:0,class:"text-#198754"},ve={key:1,class:"text-red"},fe=["onClick"],be=["onClick"],_e=A('<ul class="grid gap-2"><li>已過期 : <span class="text-red">紅色</span></li><li>三天之內 : <span class="text-orange">橘色</span></li><li>三到七天內 : <span class="text-yellow">黃色</span></li><li>七天以上 : <span class="text-green-700">綠色</span></li></ul>',1),Ce={__name:"AdminCoupons",setup(V){const{VITE_URL:h,VITE_PATH:p}=ne,s=c([]),d=c(!1),r=c({});function v(l=1){d.value=!0,w.get(`${h}/v2/api/${p}/admin/coupons?page=${l}`).then(o=>{s.value=o.data.coupons,r.value=o.data.pagination}).catch(o=>{m.fire({icon:"error",title:"錯誤發生",text:o.response.data.message})}).finally(()=>{d.value=!1})}const f=c({}),t=c(),u=c(!1);function g(){u.value=!0,f.value={},t.value.dialog.showModal()}function M(l){return k(l).format("YYYY-MM-DD")}function b(l){f.value=l,u.value=!1,t.value.dialog.showModal()}function a(l){console.log(l),u.value?w.post(`${h}/v2/api/${p}/admin/coupon`,{data:l}).then(o=>{m.fire({title:`${o.data.message}`,icon:"success",didClose:()=>{v()}}),t.value.dialog.close()}).catch(o=>{m.fire({title:"錯誤發生",text:`${o.response.data.message}`,icon:"error",target:"dialog"})}):w.put(`${h}/v2/api/${p}/admin/coupon/${l.id}`,{data:l}).then(o=>{m.fire({title:`${o.data.message}`,icon:"success",didClose:()=>{v()}}),t.value.dialog.close()}).catch(o=>{m.fire({title:"錯誤發生",text:`${o.response.data.message}`,icon:"error",target:"dialog"})})}function z(l){const{id:o}=l;m.fire({title:`你確定要刪除優惠券${l.title}`,icon:"question",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確定"}).then(n=>{n.isConfirmed&&w.delete(`${h}/v2/api/${p}/admin/coupon/${o}`).then(C=>{m.fire({title:`${C.data.message}`,icon:"success",didClose:()=>{v()}}),t.value.dialog.close()}).catch(C=>{m.fire({title:"錯誤發生",text:`${C.response.data.message}`,icon:"error",target:"dialog"})})})}function B(l){const o=Date.now()/1e3;return l-o<0?"text-red":l-o<3*24*60*60?"text-orange":l-o<7*24*60*60&&l-o>3*24*60*60?"text-yellow":"text-green-700"}return R(()=>{v()}),(l,o)=>(_(),x(E,null,[e("div",ie,[de,e("div",re,[i(T(I),{active:d.value,"is-full-page":!1},null,8,["active"]),e("div",{class:"text-end mt-6"},[e("button",{type:"button",class:"bg-#0d6efd border-0 text-white cursor-pointer inline-block px-3 py-1.5 rd font-size-4 hover:bg-#0b5ed7",onClick:g},"建立優惠券")]),e("table",ue,[ce,e("tbody",null,[(_(!0),x(E,null,q(s.value,n=>(_(),x("tr",{class:"border-b border-#DEE2E6 border-solid",key:n.id},[e("td",null,$(n.title),1),e("td",null,$(n.code),1),e("td",null,[e("span",{class:y(B(n.due_date))},$(M(n.due_date*1e3)),3)]),e("td",null,$(n.percent),1),e("td",pe,[n.is_enabled?(_(),x("span",me,"啟用")):(_(),x("span",ve,"未啟用"))]),e("td",null,[e("div",null,[e("button",{type:"button",class:"text-#0d6efd bg-transparent border-1 border-#0d6efd border-solid rd-tl rd-bl px-2 py-1 hover:bg-#0d6efd hover:text-white hover:cursor-pointer",onClick:C=>b(n)}," 編輯 ",8,fe),e("button",{type:"button",class:"text-#dc3545 bg-transparent border-1 border-#de3545 border-solid rd-tr rd-br px-2 py-1 hover:bg-#de3545 hover:text-white hover:cursor-pointer",onClick:C=>z(n)}," 刪除 ",8,be)])])]))),128))])]),_e]),s.value.length?(_(),F(O,{key:0,pages:r.value,onChangePage:v,class:"mt-auto"},null,8,["pages"])):P("",!0)]),i(ae,{"temp-coupon":f.value,ref_key:"couponModalRef",ref:t,"is-new":u.value,onConfirmCoupon:a},null,8,["temp-coupon","is-new"])],64))}};export{Ce as default};
